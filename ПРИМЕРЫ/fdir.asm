; 30.1.95   NOCAT: Errors 6,7,20; 26.12.94  Device Size > 9999; 16.6.93   17:46 ktest,-ECOLO; 25.10.92   2:46; 14.4.92   16:19; 26.1.92    2:29; fdir.as; Find DIR;=1012/1037/1022/1035	ORG	24040curID  EQU  24000runID	EQU	24004runFD	EQU	24008way	EQU	2Panel	EQU	5Tbdev	EQU	-24	JR	HPCATVECTORHMASK  DEFM |*        |HSTRT	DEFW	3HPBOT	DEFW	222HSIZE	DEFW	3192	DEFM	|UnCo|	DEFB	COLSZCOLOR  DEFB #F,#45,#4F,1,#D,7,#28COLSZ	EQU	$-COLORVECSZ	EQU	$-VECTOR;........................HPCAT       LD   C,$g_com	RST	16	EXX	LD	BC,#FFF7	ADD	HL,BC	LD	DE,runID	LD	BC,4	LDIR       LD   C,$bkfcb	RST	16	EXX	LD	DE,runFD	LD	BC,32	LDIR       LD   HL,COLOR       LD   A,(HL)       LD   (`MENU+4),A       INC  HL       LD   A,(HL)       LD   (`MENU-10),A       INC  HL       LD   A,(HL)       LD   (`MENU-12),A       INC  HL       LD   A,(HL)       LD   (`MENU+5),A       LD   (`PROMT+5),A       LD   C,$g_cur       RST  16       EXX       DJNZ 1$       LD   A,1       LD   (`PROMT),A       LD   (`MENU),A       LD   A,3       LD   (`PROMT+6),A       LD   (`MENU+6),A1$	LD	(STACK+1),SPMENU       LD   IX,`MENU       LD   A,2       LD   C,$wt	RST	16	CALL	WLCOM       LD   C,$menu	RST	16	RET	C       XOR  A       LD   A,#F2	RET*************************DYANL	DEFB	"f",1,0	DEFB	"m",2,0	DEFB	"d",3,0	DEFB	"t",4,0	DEFB	"b",5,0       DEFB "s",7,0	DEFB	"e",8,0	DEFB	" ",8,0	DEFB	#FFDYENT	DEFW	RFIND	DEFW	RMASK	DEFW	RDEV	DEFW	RSTRT	DEFW	RBOT	DEFW	RSIZE	DEFW	SAVE	DEFW	RQuit;........................	DEFB	0,0,0,2	DEFW	HPINI,0,DYANL,DYENT`MENU  DEFB 17,6,10,14,0,1,25,14	DEFB	1,1,1,1,1,1,1,1ASHP       DEFM |FIND|	DEFB	13;            12345678901234AMASK  DEFM |MASK:         |ADEV   DEFM |DEVICE:       |ASTRT  DEFM |TOP:     12345|ABOT   DEFM |BOTTOM:  12345|       DEFB 13ASIZE  DEFM |DEV SIZE:12345|       DEFM |SAVE|	DEFB	13       DEFM |EXIT|	DEFB	3;------------------------SAVE	LD	IX,curID	XOR	A       LD   C,$p_sta	RST	16	LD	IX,runID	XOR	A       LD   C,$g_sta	RST	16	RET	C       LD   C,$bkfcb	RST	16	EXX	LD	DE,runFD	LD	B,32S_1	LD	A,(DE)	CP	(HL)	LD	A,81	JR	NZ,SAVEX	INC	HL	INC	DE	DJNZ	S_1	LD	IX,VECTOR	LD	DE,VECSZ	XOR	A	LD	HL,2       LD   C,$wpart	RST	16	RET	C	LD	HL,CALC       LD   C,$run	RST	16	JR	NC,FLUSH	CP	37	SCF	RET	NZFLUSH       LD   C,$flush	RST	16	RET	CSAVEX	LD	IX,curID	XOR	A       LD   C,$g_sta	RST	16	RET	C	XOR	A	RET;-----------------------CALC   DEFM |@calc|	DEFB	13*************************HPINI	LD	HL,HMASK       LD   DE,AMASK+6	LD	BC,8	LDIR       LD   C,$g_cat	RST	16	ADD	A,"A"       LD   (ADEV+13),A	LD	DE,(HPBOT)       LD   HL,ABOT+9	CALL	IDIG	LD	DE,(HSIZE)       LD   HL,ASIZE+9	CALL	IDIG	LD	DE,(HSTRT)ISTRT  LD   HL,ASTRT+9IDIG       LD   A,5	AND	A       LD   BC,#A00+$d_a	RST	16	RET*************************RFIND       LD   C,$clear	RST	16       LD   C,$bkfcb	RST	16	EXX	LD	DE,Tbdev	ADD	HL,DE       LD   C,$g_cat	RST	16	ADD	A,A	LD	E,A	LD	D,0	ADD	HL,DE	LD	DE,(HSIZE)	LD	(HL),E	INC	HL	LD	(HL),D	LD	DE,(HSTRT)	CALL	PLWTRFND0       LD   C,$ktest	RST	16	JR	Z,FND0_1       LD   C,$key	RST	16	CP	#10	JR	Z,BREAKFND0_1       LD   C,$open1	RST	16	JR	C,NOCAT	PUSH	DE	CALL	TMODL	POP	DE	JR	NZ,RFND1	CALL	TYPE;      RET  C       JR   C,NOCAT       LD   C,$kwait	RST	16FKEY       LD   C,$key	RST	16	RES	5,A	CP	"F"	JR	Z,RFND2	CP	"N"	JR	Z,RFND2	CP	"Q"	JP	Z,REMEN	AND	A	JP	Z,REMEN	CP	13	JR	Z,FWORK	CP	"W"	JR	NZ,FKEYFWORK       LD   SP,(STACK+1)FWRK       LD   C,$gmpan	RST	16	EXX	EX	DE,HL	INC	HL	INC	HL	INC	HL	INC	HL	RES	way,(HL)	XOR	A       LD   A,#F5	RET;--------------------BREAK       LD   C,$kwait	RST	16REMENSTACK	LD	SP,0	JP	MENUNOCAT       CP   7       SCF       RET  Z       CP   20       SCF       RET  Z       CP   6       SCF       RET  Z       JR   RFND1RFND2	CALL	PLWT	LD	A,2       LD   C,$wt       RST  16RFND1       INC  DE       CALL TYSEG     ; ?	LD	HL,(HPBOT)	AND	A	SBC	HL,DE	JR	NC,RFND0	JR	REMEN;*************************RMASK       LD   H,(IX-9)       LD   L,6       LD   C,$wtpos	RST	16       LD   HL,AMASK+6	LD	A,8       LD   DE,#A01       LD   BC,#100+$smbgt	RST	16       OR   A	JR	Z,RMASK	CP	#FE	JR	C,DNPUT	XOR	A	RET;--------DNPUT       LD   BC,8	LD	DE,HMASK	LDIR	XOR	A	RET***********************RDEV       LD   H,(IX-9)       LD   L,13       LD   C,$g_dev	RST	16	RET	C	LD	B,A       LD   C,$swblk	RST	16	JR	NC,REINI       CP   6	JR	Z,RDEV	SCF	RET***********************RSTRT	LD	HL,(HSTRT)	CALL	RDIG	JR	NZ,REINI	EXX	LD	(HSTRT),HL	JR	REINI;---------------RBOT	LD	HL,(HPBOT)	CALL	RDIG	JR	NZ,REINI	EXX	EX	DE,HL	LD	HL,(HSIZE)	AND	A	SBC	HL,DE	ADD	HL,DE       JR   C,$+3       EX   DE,HL       LD   (HPBOT),HL	JR	REINI;---------------RSIZE       LD   HL,(HSIZE)	CALL	RDIG	JR	NZ,REINI	EXX	LD	A,L	AND	%11111000	LD	L,A	LD	(HSIZE),HLREINI       XOR  A	INC	A	RET;---------------------RDIG       LD   D,(IX-9)	LD	E,9       LD   A,5       LD   BC,$ed_di	RST	16	RET;************************TMODL       LD   C,$bkfcb	RST	16	EXX	LD	DE,32	ADD	HL,DE	LD	DE,HMASK	LD	B,8MAS0       LD   A,(DE)	CP	"?"	JR	Z,MAS1       CP   "!"	JR	Z,STRING       CP   "*"	JR	Z,MAS2	CP	(HL)	RET	NZMAS1	INC	HL	INC	DE	DJNZ	MAS0	RETMAS2	LD	DE,HMASK+7	PUSH	IX	POP	HL	LD	BC,7	ADD	HL,BC	LD	B,8MAS3       LD   A,(DE)	CALL	EMP_	JR	Z,MAS5	CP	"*"	RET	Z       LD   C,AMAS4       LD   A,(HL)	CALL	EMP_	JR	Z,MAS6       CP   C	RET	NZ       DEC  HL	DJNZ	MAS5       DEC  DE	LD	A,(DE)	CP	"*"	RET;--------MAS5       DEC  DE	JR	MAS3;--------------MAS6       DEC  HL	DJNZ	MAS4RQuit	OR	#FF	RET;------------------------EMP_       CP   "?"	RET	Z       CP   " "	RET*************************STRING	LD	A,32	LD	C,A	INC	BSTR	PUSH	HL	PUSH	BC	LD	DE,HMASKSTRNG	INC	DE	LD	A,(DE)	CP	C	JR	Z,QUIT       CP   (HL)	INC	HL	JR	NZ,STRN1       DJNZ STRNG	OR	CSTRN1QUIT	POP	BC	POP	HL	INC	HL	RET	Z	DJNZ	STR	RET***********************RETYP	PUSH	DE	CALL	FWRK	POP	DE	LD	A,Panel       LD   BC,#800+$shpan	RST	16	RET*************************TYPE	CALL	RETYP	RET	C       LD   HL,ADIG+10	CALL	IDIG	LD	A,(COLOR+6)	LD	HL,MPRMTTYWT	PUSH	IX	LD	IX,`PROMT	LD	(IX+4),A	LD	A,2       LD   C,$wt	RST	16       LD   C,$lenwt	RST	16	POP	IX	XOR	A	RET*************************PLWT	LD	HL,MPLWT	LD	A,(COLOR+5)	JR	TYWTWLCOM	LD	HL,MWLCM	LD	A,(COLOR+4)	JR	TYWT;------------------------TYSEG	CALL	ISTRT	LD	HL,ASHP       LD   C,$lenwt	RST	16	RET*************************`PROMT	DEFB	17,18,5,14,0,1,24,16MPRMT  DEFM | Directory|	DEFB	13ADIG   DEFM | Position:12345|       DEFM | Find Work Quit|MPLWT	DEFB	13       DEFM |  Wait please|	DEFB	3MWLCM  DEFM |   Welcome to|	DEFB	13       DEFM |Directory Finder|	DEFB	13       DEFM |Iskra 1995.  СПб|	DEFB	3;**;**