;  3.6.95   #D#D ringsum #C;  2.6.95   No Sp before D; 16.10.94  20:49 I_FLhi;  6.4.94   16:34;(27.2.94   20:49 Speed);(12.9.93   12:51); ibm_is.asm (is_ibm.asm);      ibm_is.com/res;Convert text from IBM (MULTI-EDIT); to iS-DOS .txt;=374(332)	ORG	24000	IF	.KEY  ; RES ----	DEFS	4	XOR	A	SBC	HL,HL	LD	(SHIFT+1),HL	DEC	HL	LD	(BLOCK+1),HL	LD	C,$bkfcb	RST	16	EXX	DEC	HL	LD	A,(HL)	LD	(I_FILE+1),A	INC	HL	ELSE	;--- COM - via CURSOR:	LD	C,$g_curs	RST	16	LD	(I_FILE+1),A	LD	C,$opnum	OR	A	RET	Z	RST	16	RET	C	EXX	END	;-------------------	LD	DE,FILE	LD	BC,8	LDIR	LD	C,3	ADD	HL,BC	LD	A,(HL)	AND	#20 ; CAT	RET	NZ	ADD	HL,BC	LD	A,(HL)	INC	HL	LD	E,(HL);+ BIG files	INC	HL	LD	D,(HL)	LD	(I_FLhi+1),DE	LD	(I_FLlo+1),A	LD	C,12 ; Version	ADD	HL,BC	LD	DE,FILE+28	LD	C,4	LDIR	LD	C,$g_cnfg	RST	16	EXX	LD	C,5	ADD	HL,BC	LD	E,(HL)	INC	HL	LD	D,(HL)	EX	DE,HL	LD	DE,O_BUF	XOR	A	SBC	HL,DE	LD	L,A ; 0	LD	(OBUFSZ+1),HL	LD	HL,FILE	LD	C,$crfil	RST	16	RET	C	EXX	DEC	HL	LD	A,(HL)	LD	(O_FILE+1),A	LD	(OPNUM+1),A	SBC	HL,HL;In shft	LD	E,L	LD	D,L;Line Nr.	LD	C,$mwait	RST	16; * * * * * * * * * * * *REPEAT;Get the byte:I_FILE	LD	A,0	CALL	OPNUM	RET	C	PUSH	HLBLOCK	LD	HL,#FFFF	XOR	A	SBC	HL,DE	LD	HL,I_BUF	LD	C,$rvblk	CALL	NZ,16	LD	(BLOCK+1),DE	POP	HL	RET	C	PUSH	HL	EXX	POP	BC	LD	B,0	LD	HL,I_BUF	ADD	HL,BC	LD	A,(HL)	EXX;NEXT:	INC	L	JR	NZ,$+3	INC	DE;What shall we do with it	CP	#A	CALL	NZ,PRINT	RET	C	PUSH	HLI_FLhi	LD	HL,0	XOR	A	SBC	HL,DE	POP	HL	JR	NZ,REPEATI_FLlo	LD	A,0	CP	L	JR	NZ,REPEAT	LD	A,3	CALL	PRINT	RET	C;FINAL CUT:	LD	DE,(SHIFT+1)	LD	A,E	OR	D	JR	Z,FLUSH;add and write the rest:	LD	HL,(OBUFSZ+1)	DEC	HL	LD	(SHIFT+1),HL	CALL	PRINT	RET	C;CUT all the superfluous	LD	HL,(OBUFSZ+1)	XOR	A	SBC	HL,DE	EX	DE,HL	LD	C,$ecut	RST	16	RET	CFLUSH	LD	C,$flush	RST	16	RET	CEXIT	XOR	A	LD	A,#F4	RET;------------------------NOT_C	CP	#D	JR	Z,PRT_1	LD	(Char+1),A	LD	A,(PREV+1)	CP	#C	JR	NZ,Char	LD	A,#D	CALL	Print	RET	C	JR	Char;-------------PRINT;+	CP	#C	JR	NZ,NOT_C	LD	A,#DPREV	CP	#D	JR	Z,PRT_C	CALL	PRT_1	RET	CPRT_C	LD	A,#C;+PRT_1	CP	" "	JR	NZ,NOT_SpSp_CNT	LD	A,0	INC	A	LD	(Sp_CNT+1),A	RET;-------NOT_Sp	LD	(Char+1),A	XOR	#D	JR	NZ,2$1$	LD	(Sp_CNT+1),A2$	LD	A,(Sp_CNT+1)	OR	A	JR	Z,Char	LD	A," "	CALL	Print	RET	C	LD	A,(Sp_CNT+1)	DEC	A	JR	1$;------------Char	LD	A,0Print;+	LD	(PREV+1),A	PUSH	BC	PUSH	DE	PUSH	HLSHIFT	LD	BC,0	LD	HL,O_BUF	ADD	HL,BC	LD	(HL),A	INC	BCOBUFSZ	LD	HL,0	OR	A	SBC	HL,BC	JR	NZ,P_SHFT	LD	BC,0P_SHFT	LD	(SHIFT+1),BC	JR	NZ,PRTEXO_FILE	LD	A,0	CALL	OPNUM	JR	C,PRTEX	EXX	LD	BC,15	ADD	HL,BC	LD	E,(HL)	INC	HL	LD	D,(HL)	LD	A,(OBUFSZ+2)	LD	B,A	LD	C,$fadd	RST	16	JR	C,PRTEX	LD	C,$wifle	LD	HL,O_BUF	RST	16PRTEX	POP	HL	POP	DE	POP	BC	RET;------------------------FILE	DEFS	8	DEFM	|txt|	DEFS	3O_FLEN	DEFS	3	DEFS	15;------------------------OPNUM	CP	0	RET	Z	LD	(OPNUM+1),A	LD	C,$opnum	RST	16	RET;-----------------------	IF	.KEYI_BUF	EQU	24000O_BUF	EQU	24256	ELSEI_BUF	EQU	$O_BUF	EQU	$+#100	END;**;**