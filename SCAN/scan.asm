	ORG  #E093LB	EQU	#BLC	EQU	#CLD	EQU	#DL1A	EQU	#1AL37	EQU	#37L86D	EQU	#86DL7753	EQU	#7753       DEFW #0000       DEFW #0000	XOR  A	LD   (LE103),A	LD   C,#52       RST  #10          ; получаем данные резидента из параметра. A-номер канала	RET  C	LD   (LE108),A	LD   A,#25       SCF	RET  NZLE0A6	LD   C,#45	RST  #10       EXX	LD   BC,LFFFB	ADD  HL,BC       LD   (LE10E),HL  ; адрес указателя в командной строке	LD   C,(HL)	INC  HL	LD   B,(HL)       LD   (LE10A),BC  ; текущий указатель в командной строке	LD   C,#43	RST  #10	RET  C	EX   AF,AF'	LD   A,(LE103)	EX   AF,AF'       JR   NZ,LE0E8       EXX	OR   A	JR   Z,LE0D5	RES  5,A	CP   #58	JR   NZ,LE0E8	EX   AF,AF'	OR   #20LE0D0	LD   (LE103),A	JR   LE0A6LE0D5	EX   AF,AF'	LD   B,A	AND  #84	LD   A,B	JR   NZ,LE0E9	SET  7,A	LD   DE,LE118	LD   BC,LB       LDIR	JR   LE0D0LE0E8	EX   AF,AF'LE0E9	BIT  7,A	JR   NZ,LE151	OR   #FF       RETLE0F0	LD   C,#35	RST  #10       EXX	LD   DE,LE118	LD   C,#8F	RST  #10	RET  NZ	PUSH HL	LD   BC,LB	ADD  HL,BC	LD   A,(HL)	POP  HL	XOR  #0LE103  EQU  $-#1         ; маска каталогов       AND  #20          ; каталог?	RET  NZ       LD   A,#FF        ; если да, то делаем вызов резидентаLE108	EQU	$-#1	LD   BC,0LE10A	EQU	$-#2	LD   (0),BCLE10E	EQU	$-#2	LD   DE,LE118	LD   BC,L7753	RST  #10       RETLE118	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	LD   C,#86	RST  #10       EXX	PUSH HL       EXX	POP  HL       RETLE12B	DEFB	#01	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00LE133	LD   HL,LE12B	LD   BC,0LE137	EQU	$-#2	ADD  HL,BC       RETLE13B	LD   HL,LE137	LD   A,(HL)	OR   A	RET  Z	DEC  (HL)	XOR  A	LD   C,#26	RST  #10	RET  C       EXX	LD   BC,LD	CALL LE1A9	RET  C	JR   LE1A3LE151	XOR  A	LD   (LE137),A	LD   (LE12B),ALE158  LD   C,#9         ; проверяем нажатие SS+A	RST  #10	JR   Z,LE163	LD   C,#7	RST  #10	CP   #10	RET  ZLE163  CALL LE133       ; получаем в HL адрес байта в стеке каталогов	LD   A,(HL)       LD   C,#26       ; открываем файл в текущем каталоге. Номер файла - (HL)	RST  #10	JR   NC,LE172	CP   #50	JR   Z,LE13B       SCF       RETLE172  EXX       DEC  HL           ; в HL-адрес открытого файлового дескриптора	LD   A,(HL)	OR   A	JR   Z,LE19F	LD   BC,LC	ADD  HL,BC       BIT  0,(HL)       ; проверяем бит удалён/существует       JR   Z,LE1A3      ; нашли удалёный файл. Счётчик файлов увеличится на 1       BIT  5,(HL)       ; проверяем бит файл/каталог       JR   Z,LE19F      ; переход, если файл       LD   B,#3         ; если каталог-проверяем что в расширении 3 пробелаLE186	DEC  HL	LD   A,(HL)	CP   #20	JR   NZ,LE1A3	DJNZ LE186       CALL LE1A9        ; открыли каталог, напечатали его имя	RET  C	LD   HL,LE137       INC  (HL)         ; добавили уровень вложенности на 1	CALL LE133	XOR  A       LD   (HL),A       ; вписали в масив 0       LD   C,#26        ; открыли файл по номеру (0)	RST  #10	RET  CLE19F	CALL LE0F0	RET  CLE1A3  CALL LE133       ; увеличиваем на 1 счётчик файлов в текущем каталоге	INC  (HL)	JR   LE158LE1A9  ADD  HL,BC       ; HL-первый символ расширения, BC=#000C       LD   D,(HL)      ; DE-номер 0-го ,лока каталога по смещ. 19	DEC  HL	LD   E,(HL)	LD   HL,L1A       LD   C,#C        ; выставляем позицию печати 0,26	RST  #10       LD   C,#21       ; открыть каталог по номеру 0-го блока в DE	RST  #10	RET  C	LD   C,#35	RST  #10       EXX	LD   BC,L37	ADD  HL,BC       LD   A,(HL)      ; получаем уровень вложенности каталога       CP   #6          ; сравниваем с 6 - максимальный уровень	JR   C,LE1C6       LD   A,#6        ; если уровень вложенности больше 6, пишем 6LE1C6	LD   E,A	LD   A,#7       SUB  E           ; вычитаем уровень вложености из 7	LD   B,A	LD   C,#ALE1CD  LD   A,#20       ; печатаем такое количество пробелов	RST  #10	DJNZ LE1CD	LD   B,E	INC  B	DEC  B	JR   Z,LE1DCLE1D7  LD   A,#2E       ; печатаем точки по количеству вложености	RST  #10	DJNZ LE1D7LE1DC  LD   A,#5C       ; печатаем \	RST  #10	LD   BC,LFFE9	ADD  HL,BC	LD   BC,L86D       RST  #10         ; печатаем имя каталога       RETLFFE9	EQU	#FFE9LFFFB	EQU	#FFFB