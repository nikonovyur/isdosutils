; Утилита mkdir - создание каталога; При вызове без параметров создаёт каталог в интерактивном режиме       ORG  #61A8        ; 25000	XOR  A       LD   IX,L6388     ; Сохраняем значение текущего устройства (4 байта) в памяти	LD   C,#36	RST  #10       LD   HL,L62D5       CALL MKDIR       RET  C       LD   HL,L62D6       CALL MKDIR       RET  C; Очень хитрый выход с восстановлением среды и открытием устройстваL626B  PUSH AF       XOR  A       LD   IX,L6388       LD   C,#37       ; восстанавливаем заранее сохранённyю среду       RST  #10       POP  BC       RET  C       PUSH BC       POP  AF       RET  C       LD   C,#43       ; открывает устройство и каталог по пути, содержащемся во внутреннем буфере командной строки       RST  #10       RET  C       XOR  A       LD   A,#F2       RET; Процедура создания, HL' - адрес дескриптораMKDIR       PUSH HL       POP  IX       LD   C,#23        ; Создаём каталог       RST  #10       JP   C,L626B       EXX       LD   BC,#000B       ADD  HL,BC       LD   A,(HL)       ; A - регистр состояния       LD   C,#6       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       ; DE - номер блока описателя сегментов       AND  #40          ; Проверка 6-го бита непрерывный ли файл?       JR   NZ,MKD01     ; каталог непрерывный - переходим       RST  #10          ; блок номер DE считываем в кэш       JP   C,L626B       EXX       INC  HL       LD   E,(HL)       INC  HL       LD   D,(HL)       PUSH DE       EXX       POP  DEMKD01  INC  HL       LD   (HL),E       INC  HL       LD   (HL),D       LD   C,#28       RST  #10       JR   C,L626B       PUSH DE       LD   BC,#FFEC       ADD  HL,BC       LD   BC,#0020       PUSH IX       POP  DE       LDIR             ; копируем в локальный дескриптор внутренний дескриптор с обновлёнными данными       LD   C,#10       ; далее заполняем дескриптор дефолтным содержимым (1 элемент каталога и т.д. )       ADD  HL,BC       LD   A,(HL)       INC  HL       INC  HL       INC  HL       LD   E,(HL)       INC  HL       LD   D,(HL)       INC  HL       INC  HL       INC  HL       OR   (HL)       INC  A       LD   (IX+#0C),E       LD   (IX+#0D),D       LD   (IX+#17),A       LD   (IX+#15),#01       POP  DE       LD   C,#6        ; считываем первый блок каталога       RST  #10       RET  C       EXX       PUSH DE       EX   DE,HL       PUSH IX       POP  HL       LD   BC,#0020       LDIR             ; заполняем первый элемент каталога своим же дескриптором       LD   C,#DF       LD   L,E       LD   H,D       INC  DE       LD   (HL),#0       LDIR             ; остальная часть блока - нули       POP  DE       LD   C,#2E       ; помечаем блок в кэше как модифицированный       RST  #10       RET  C; В регистре A - вычисляем количество блоков, подлежащих забивке нулями       LD   L,(IX+#0E)       LD   H,(IX+#0F)       LD   A,L       OR   A       LD   A,H       JR   NZ,MKD02       DEC  AMKD02  OR   A       JR   Z,MKD05       LD   B,A       LD   DE,#0001; цикл забивки нулями блоков каталога, следующих за первымMKD03  LD   C,#2D      ; читаем блок в кэш       RST  #10       RET  C       EXX             ; получаем в HL' адрес блока в кэше       XOR  A       LD   B,AMKD04  LD   (HL),A     ; пишем в блок нули       INC  HL       DJNZ MKD04       PUSH DE       EXX       POP  HL       EX   DE,HL       LD   C,#2E      ; помечаем блок в кэше как модифицированный       RST  #10       RET  C       EX   DE,HL       INC  DE       DJNZ MKD03MKD05	LD   C,#2	RST  #10       RET; Дескриптор каталогаL62D5  DEFB "M"       DEFB "K"       DEFB "D"       DEFB "I"       DEFB "R"       DEFB "0"       DEFB "0"       DEFB "1"       DEFB #20       DEFB #20       DEFB #20       DEFB #21       DEFB #00       DEFB #00       DEFB #00       DEFB #03       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #2B       DEFB #5B; Дескриптор каталогаL62D6  DEFB "M"       DEFB "K"       DEFB "D"       DEFB "I"       DEFB "R"       DEFB "0"       DEFB "0"       DEFB "2"       DEFB #20       DEFB #20       DEFB #20       DEFB #21       DEFB #00       DEFB #00       DEFB #00       DEFB #03       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #00       DEFB #2B       DEFB #5BL6388  DEFB #00       DEFB #00       DEFB #00       DEFB #00