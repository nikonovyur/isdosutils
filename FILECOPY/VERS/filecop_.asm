	ORG  #5DC0L6	EQU	#6L8	EQU	#8LB	EQU	#BLC	EQU	#CLF	EQU	#FL10	EQU	#10L14	EQU	#14L20	EQU	#20L37	EQU	#37L100	EQU	#100L101	EQU	#101L202	EQU	#202L26E	EQU	#26EL301	EQU	#301L505	EQU	#505LA7C	EQU	#A7CLB00	EQU	#B00L2036	EQU	#2036L3A5E	EQU	#3A5EL3D5D	EQU	#3D5DL4000	EQU	#4000	JP   L6575L5DC3	DEFB	#03L5DC4  DEFB #0B         ; использование буфера для копированияL5DC5  DEFB #20         ; максимальное количество файлов за 1 заходL5DC6	DEFB	#0CL5DC7	DEFB	#3E	DEFB	#FFL5DC9  DEFW #7FFDL5DCB  DEFB #C0L5DCC	DEFB	#10L5DCD	DEFB	#C7; Страницы памяти буфера 80кбL5DCE  DEFB #11L5DCF  DEFB #13L5DD0  DEFB #14L5DD1  DEFB #16L5DD2  DEFB #17       DEFM "UnCo"       DEFB #11L5DD8	DEFB	#05	DEFB	#20L5DDA	DEFB	#03	DEFB	#04	DEFB	#28	DEFB	#A0	DEFB	#05	DEFB	#20	DEFB	#05	DEFB	#20	DEFB	#05	DEFB	#90	DEFB	#90L5DE5	DEFB	#04	DEFB	#03L5DE7	DEFB	#06	DEFB	#28L5DE9       DEFW L5DFF       DEFW L5E02       DEFW L5E05       DEFW L5E08       DEFW L5E0B       DEFW L5E0E       DEFW L5E11       DEFW L5E14       DEFW L5E17       DEFW L5E1A       DEFW L5DFFL5DFF       DEFB #20       DEFW L5E1DL5E02	DEFB	#20       DEFW L5E22L5E05	DEFB	#20       DEFW L5E27L5E08	DEFB	#20       DEFW L5E2CL5E0B	DEFB	#20       DEFW L5E31L5E0E	DEFB	#20       DEFW L5E36L5E11       DEFB #20       DEFW L5E3BL5E14	DEFB	#20       DEFW L5E40L5E17	DEFB	#20       DEFW L5E45L5E1A	DEFB	#20       DEFW L5E4CL5E1D       LD   A,(L5DCE)       JR   L5E48L5E22       LD   A,(L5DCE)       JR   L5E4FL5E27       LD   A,(L5DCF)       JR   L5E48L5E2C       LD   A,(L5DCF)       JR   L5E4FL5E31       LD   A,(L5DD0)       JR   L5E48L5E36       LD   A,(L5DD0)       JR   L5E4FL5E3B       LD   A,(L5DD1)       JR   L5E48L5E40       LD   A,(L5DD1)       JR   L5E4FL5E45       LD   A,(L5DD2)L5E48       LD   D,#C0       JR   L5E7AL5E4C       LD   A,(L5DD2)L5E4F       LD   D,#E0       JR   L5E7AL5E53       DEFW L5E5D       DEFW L5E60       DEFW L5E63       DEFW L5E66       DEFW L5E5DL5E5D       DEFB #10       DEFW L5E69L5E60	DEFB	#10       DEFW L5E6DL5E63	DEFB	#10       DEFW L5E71L5E66	DEFB	#10       DEFW L5E75L5E69       LD   D,#00       JR   L5E77L5E6D       LD   D,#10       JR   L5E77L5E71       LD   D,#20       JR   L5E77L5E75       LD   D,#30L5E77       LD   A,(L5DCD)L5E7A       DI       EXX       LD   BC,#0000L5E7D  EQU $-2       OUT  (C),A       EXX       LD   C,#00       LD   E,C       LD   HL,(L64FD)L5E88       LD   A,(DE)       LDI       DEC  HL       LD   (HL),A       INC  HL       LD   A,B       OR   C       JR   NZ,L5E88       EXX       LD   A,#00L5E94  EQU $-1       OUT  (C),A       EI       XOR  A       RETL5E9A  DEFB #01	DEFB	#0A	DEFB	#03	DEFB	#0EL5E9E  DEFB #00	DEFB	#FF	DEFB	#03	DEFB	#28L5EA2	DEFB	#02	DEFB	#0D	DEFB	#03	DEFB	#05L5EA6  DEFB #00	DEFB	#FF	DEFB	#04	DEFB	#03L5EAA	DEFB	#20	DEFB	#20	DEFB	#20L5EAD	DEFB	#11	DEFB	#0A	DEFB	#03	DEFB	#0EL5EB1  DEFB #00	DEFB	#FF	DEFB	#18	DEFB	#28L5EB5	DEFB	#19	DEFB	#0D	DEFB	#03	DEFB	#05L5EB9  DEFB #00	DEFB	#FF	DEFB	#23	DEFB	#03L5EBD	DEFB	#20	DEFB	#20	DEFB	#20L5EC0  DEFB #09	DEFB	#0D	DEFB	#03	DEFB	#0EL5EC4  DEFB #00	DEFB	#FF	DEFB	#12	DEFB	#06       DEFM "SOURCE"L5ECE  DEFB #09	DEFB	#0D	DEFB	#03	DEFB	#0EL5ED2  DEFB #00	DEFB	#FF	DEFB	#10	DEFB	#0B       DEFM "DESTINATION"L5EE1  DEFB #09	DEFB	#14	DEFB	#03	DEFB	#0EL5EE5  DEFB #00	DEFB	#FF	DEFB	#12	DEFB	#07       DEFM "No path"L5EF0  DEFB #09	DEFB	#14	DEFB	#03	DEFB	#0EL5EF4  DEFB #38	DEFB	#FF	DEFB	#0D	DEFB	#11       DEFM "Not iS-DOS disk !"L5F09  DEFB #04	DEFB	#12	DEFB	#05	DEFB	#18	DEFB	#00	DEFB	#FF	DEFB	#08	DEFB	#1B       DEFM "FILE   "L5F18  DEFB #00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00       DEFM "  EXISTS"       DEFB #0D	DEFB	#0D       DEFM "   Over    Skip    Quit"       DEFB #03L5F46	DEFB	#07	DEFB	#14	DEFB	#03	DEFB	#06	DEFB	#07; вектор окна со строкой куда копироватьL5F4B  DEFB #02	DEFB	#10	DEFB	#04	DEFB	#1CL5F4F  DEFB #00	DEFB	#FF	DEFB	#04	DEFB	#21L5F53                    ; путь куда копировать       DEFB #00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#0D; подпрограма вывода окна с вектором в IX и установки координат печати в левый верхний уголL5F96  XOR  A	LD   C,#61	RST  #10	LD   HL,L100	LD   C,#6B	RST  #10       RETL5FA1	LD   IX,L5F4B	CALL L5F96	LD   HL,L5F53       LD   A,#0       ; если здесь не 0 - редактор не выводитсяL5FAC	EQU	$-#1	OR   A	JR   NZ,L5FBF	LD   A,#21	LD   DE,LB00	LD   BC,L26E	RST  #10	PUSH AF	CALL L5FC4	POP  AF       RETL5FBF	LD   C,#67	RST  #10	XOR  A       RETL5FC4	LD   A,#0L5FC5	EQU	$-#1	AND  A	RET  Z	LD   IX,L5F09	LD   A,(L5DDA)	LD   (IX+#4),A	XOR  A	LD   (L5FC5),A	INC  A	LD   C,#61	RST  #10	LD   IX,L5F4B	JR   L5FF5L5FE0	LD   IX,L5EF0	JR   L5FEAL5FE6	LD   IX,L5EE1L5FEA	LD   A,#55	LD   (L5FC5),A	JR   L5FF5L5FF1	LD   IX,L5EC0L5FF5	XOR  A	LD   C,#61	RST  #10	LD   C,#66	RST  #10       RETL5FFD	CALL L5F96	EX   DE,HL	LD   B,#8	CALL L600C	LD   BC,L8	ADD  HL,BC	LD   B,#3L600C	LD   C,#6D	RST  #10	LD   A,#20	LD   C,#A	RST  #10       RETL6015  CALL L687F        ; странный цикл с выбором адреса списка (?)	CALL L6059	RET  C	LD   A,(L62FD)	LD   DE,0L6020	EQU	$-#2	LD   HL,0L6023  EQU  $-#2         ; адрес тела канала текущей панели	LD   (HL),A	INC  HL	LD   (HL),E	INC  HL	LD   (HL),D	INC  HL	LD   A,(L5DC3)	BIT  3,A	JR   Z,L6045	LD   A,(L62FC)	LD   DE,0L6036	EQU	$-#2	LD   B,A       LD   C,#1C       ; переключение блочных устройств	RST  #10	RET  C       LD   C,#F        ; настройка драйвера на диск	RST  #10	RET  C       LD   C,#21       ; открыть каталог	RST  #10	RET  CL6045	XOR  A       LD   A,#F6       ; выход       RETL6049	LD   C,#2	RST  #10	RET  C	CALL L5FF1	LD   A,(L5DC3)       CALL L630A        ; странное действие с массивами буфера	CALL L6555L6059	LD   A,(L62FC)	LD   DE,(L6036)       CALL L637E        ; открыть диск и каталог источника	RET  C	LD   A,(L6094)L6067	LD   (L6094),A       CALL L636A        ; получили дескриптор файла       JR   NC,L6081     ; читаем следующий файл       PUSH BC           ; прочитали все файлы	PUSH DE	LD   DE,L202	LD   IX,L5E9A       LD   C,#62        ; рисуем двойную рамку окна слева "всё прочитано"	XOR  A	RST  #10	POP  DE	POP  BC	JP   L6136L6081	BIT  7,C	JR   NZ,L6089	BIT  6,C	JR   Z,L608FL6089	LD   A,(L6094)	INC  A	JR   L6067L608F	LD   (L60DD),DE	LD   DE,0L6094	EQU	$-#2	XOR  A	LD   A,#3	LD   HL,L5EAA       LD   BC,LA7C     ; преобразуем номер файла для левого окна	RST  #10	LD   IX,L5EA2       CALL L5FF5       ; выводим номер копируемого файла слева в окошке       CALL L6343       ; вернуть в IX адрес дескриптора, в HL - размер файла в блоках	RET  C	LD   (L63C3),HL       EXX	LD   DE,0L60B0	EQU	$-#2	LD   (L60F5),DE       LD   BC,#000C       LDIR             ; в область дескрипторов копируем дескриптор копируемого файла	DEC  DE	EX   DE,HL	LD   A,#0L60BE	EQU	$-#1       BIT  6,(HL)      ; проверяем сегментированный/непрерывный       JR   Z,L60CB     ; сегментированный - переходим       BIT  2,A         ; проверка бита защиты от чтения	JR   Z,L60D1	RES  6,(HL)	JR   L60D1L60CB	BIT  1,A	JR   Z,L60D1	SET  6,(HL)L60D1	EX   DE,HL       LD   BC,#0014	INC  DE       LDIR              ; копируем остальные 20 байт дескриптора из кэша	LD   (L60B0),DE	LD   DE,0L60DD	EQU	$-#2       CALL L633E        ; открыть файл по номеру в A	RET  C       CALL L635E        ; по номеру файла в каталоге в E возвращает в A номер отметки	BIT  4,A	JR   Z,L60F0	LD   A,#0L60EB	EQU	$-#1	LD   HL,(L60F5)	LD   (HL),AL60F0	LD   IX,L5E9A	LD   DE,0L60F5	EQU	$-#2       CALL L5FFD       ; вывод окна слева с именем читаемого файла       CALL L639D       ; читаем в буфер файл, если влезает, или весь буфер, если не влезает	RET  C	PUSH AF	POP  HL	LD   (L612F),HL	CALL L635E	LD   A,(L60BE)       RRA	JR   NC,L611F	LD   A,(HL)	BIT  6,A	JR   Z,L611F	LD   A,(L60DD)	LD   C,#26	RST  #10	RET  C	LD   C,#3C	RST  #10	RET  C	CALL L635EL611F  RES  7,(HL)       ; отмечаем в отметке файла бит "прочитан"	LD   A,#0L6122	EQU	$-#1	INC  A	LD   (L6122),A	LD   DE,(L5DC5)	CP   E	JR   Z,L6136	LD   DE,0L612F	EQU	$-#2	PUSH DE	POP  AF	JP   Z,L6089L6136  LD   A,(L60BE)   ; переходим сюда, когда надо записать файлы       RRA	JR   NC,L6140	LD   C,#2	RST  #10	RET  CL6140	LD   IX,L5ECE       CALL L5FF5       ; вывод окна DESTINATION	LD   A,(L5DC3)	BIT  2,A	JP   Z,L62DE	CALL L630AL6152  CALL L6555       ; сброс кэша на 12 блоков	LD   A,(L62FD)	LD   DE,(L6020)       CALL L637E       ; переключение блочного устройства, открытие каталога (для записи)	RET  C	LD   A,#0L6161	EQU	$-#1	LD   (L6161),AL6162	EQU	$-#3	CALL L636A	LD   (L60DD),DE	JP   C,L629A	BIT  5,C	JP   Z,L6049	BIT  4,C	JP   NZ,L6251	LD   HL,(L60B0)	LD   A,(HL)	LD   (L60EB),AL6180  CALL L6326       ; проверяем наличие целевого файла       JP   C,L6204     ; ошибка открытия файла с именем записи - переходим       LD   A,(L5DC3)   ; здесь идёт ветка запроса перезаписи файла       RRA	JP   NC,L6292       RRA	JR   NC,L61F7	LD   HL,(L60B0)	LD   DE,L5F18	LD   BC,L8       LDIR	LD   A,#20	LD   (DE),A	INC  DE	LD   C,#3       LDIR	LD   IX,L5F09	LD   HL,(L5DE7)	LD   (IX+#4),L	LD   (L5FC5),A	CALL L5FF5	LD   A,#1	LD   B,H	LD   C,#64	RST  #10	LD   IX,L5F46	LD   DE,L505	LD   L,(IX+#0)	LD   B,#3L61C5	XOR  A	LD   C,#62	RST  #10	LD   A,(IX+#0)	ADD  A,#6	LD   (IX+#0),A	DJNZ L61C5	LD   (IX+#0),LL61D6	LD   C,#8	RST  #10	DEC  C	RST  #10	CP   #73	JP   Z,L6292	CP   #71	JP   Z,L629A	CP   #53	JP   Z,L628D	CP   #6F	JR   Z,L61F7	CP   #4F	JR   NZ,L61D6	LD   HL,L5DC3	RES  1,(HL)L61F7	LD   C,#35	RST  #10       EXX	XOR  A	LD   (HL),A	LD   C,#28	RST  #10	RET  C	JP   L6180L6204  CP   #51         ; проверяем код ошибки 81 - файл не существует       SCF       RET  NZ          ; на выход с ошибкой, если ошибка другая	LD   HL,(L60B0)       LD   C,#50       ; проверяем на корректность имя файла	XOR  A	RST  #10	RET  C	PUSH HL       LD   BC,#000F	ADD  HL,BC	LD   E,(HL)	INC  HL	LD   D,(HL)	LD   (HL),B	LD   (L623A),HL	INC  D	DEC  D	JR   NZ,L622B	LD   A,E	INC  A	JR   Z,L622B	POP  HL       LD   C,#3B       ; создание целевого файла	RST  #10	RET  C	JR   L6251L622B	DEC  HL	RES  7,(HL)	DEC  HL	DEC  HL	DEC  HL	DEC  HL	LD   (HL),#1	POP  HL       LD   C,#3B       ; создание целевого файла	RST  #10	RET  C	LD   HL,0L623A	EQU	$-#2	LD   (HL),D	DEC  HL	LD   (HL),E	LD   A,E	AND  #80	OR   D	JR   Z,L6251       RLCA       RLCA	LD   B,AL6248	LD   DE,L4000       LD   C,#31        ; добавить в конец файла DE байт	RST  #10	RET  C	DJNZ L6248L6251  CALL L6326        ; открываем файл по имени	RET  CL6255  CALL L5FC4        ; при каких-то условиях рисуем какие-то окна	CALL L6422	RET  C	CALL L635E	BIT  7,A	JR   NZ,L6279	PUSH AF	LD   IX,L5EAD	LD   DE,(L60B0)       CALL L5FFD        ; рисуем правое окно с записываемым файлом	POP  AF	BIT  6,A	JP   Z,L6049       CALL L6326        ; открываем записаный файл по имени	RET  CL6279	LD   A,(L6161)	LD   HL,(L60B0)	LD   BC,L20	ADD  HL,BC	LD   (L60B0),HL	INC  A	LD   (L6161),A	JP   L6162L628D	LD   HL,L5DC3	RES  0,(HL)L6292	CALL L635E	SET  7,A	LD   (HL),A	JR   L6255L629A	LD   C,#2	RST  #10	RET  C	CALL L62A4	RET  C	XOR  A       RETL62A4	LD   DE,0L62A7	LD   (L60DD),DE	CALL L6343	JR   C,L62D0	LD   A,(IX+#B)       RRA	JR   NC,L62C2	PUSH IX	POP  HL	XOR  A	CP   (HL)	JR   NZ,L62C2	LD   C,#24	RST  #10	JR   C,L62D0L62C2	LD   DE,(L60DD)	INC  DE	LD   A,#7F	CP   E	JR   NZ,L62A7L62CC	LD   C,#2	RST  #10       RETL62D0	CP   #59	JR   Z,L62C2	CP   #50	JR   Z,L62CC	CP   #65	JR   Z,L62CC       SCF       RETL62DE	SET  2,A	LD   (L5DC3),A       CALL L630A       ; если поднят флаг, запрашиваем нажатия клавиш       JR   NZ,L6307    ; кнопки не нажимали, преходим       CALL L6555       ; пересоздание кэшаL62EB	CALL L653D	RET  C	JR   Z,L62F8	CALL L5FA1	RET  C	JR   Z,L62EB       RETL62F8	CALL L5FC4	LD   HL,0L62FC	EQU	$-#2	LD   A,LL62FD	EQU	$-#2	SUB  H	JR   Z,L6307	LD   HL,L5DC3	SET  3,(HL)L6307	JP   L6152L630A	BIT  3,A	RET  NZL630D	LD   C,#8	RST  #10	DEC  C	RST  #10	CP   #D	RET  Z	CP   #17	JR   Z,L6320	CP   #10	JR   NZ,L630D	LD   C,#80	RST  #10L6320	LD   HL,L5DC3	SET  3,(HL)	RET  ZL6326	LD   HL,(L60B0)	PUSH HL	LD   DE,L6532	LD   B,#BL632F	LD   A,(DE)       CP   #FF         ; проверяем файл по маске	JR   Z,L6335	LD   (HL),AL6335	INC  HL	INC  DE	DJNZ L632F	POP  HL       LD   C,#34       ; пробуем перед записью файла открыть файл с этим именем	RST  #10       RETL633E	LD   A,E	LD   C,#26	RST  #10       RETL6343	LD   DE,(L60DD)	LD   C,#27	RST  #10	RET  C       EXXL634C	PUSH HL       EXX	POP  IX	LD   L,(IX+#F)	LD   H,(IX+#10)	LD   A,(IX+#E)	OR   A	RET  Z	INC  HL       RETL635D	JP   (HL); L60DD - номер файла в каталоге; возвращает в HL-адрес байта состояния отметки файлаL635E  LD   DE,(L60DD)L6362	LD   C,#86	RST  #10       EXX	PUSH HL       EXX	POP  HL       RETL636A	LD   B,A	XOR  A	LD   E,A; перебираем файлы в каталоге, ищем следующий файлL636D  LD   A,#0         ; максимальный номер файла в каталогеL636E	EQU	$-#1	CP   E       RET  C            ; возвращаемся, если список файлов закончился	PUSH BC	CALL L6362	POP  BC	LD   C,(HL)	DEC  HL	LD   A,(HL)	CP   B       RET  Z            ; возвращаемся, если нашли файл	INC  E	JR   L636DL637E	LD   B,A       LD   C,#1C        ; переключить блочное устройство	RST  #10	RET  C	LD   A,(L5DC3)	BIT  3,A	JR   NZ,L638E       LD   C,#F         ; диск тотже - автонастройка диска	RST  #10	RET  CL638E  LD   C,#21        ; открыть каталог	RST  #10	RET  C	XOR  A	LD   (L6122),A	LD   HL,L6575	LD   (L60B0),HL       RETL639D	LD   A,#FFL639E	EQU	$-#1	OR   A	CALL NZ,L64B7	LD   (L639E),A	CALL L635E	RES  7,A	BIT  5,A	JR   NZ,L63BA	SET  5,A	SET  7,A	LD   DE,0	LD   (L63C6),DEL63BA	LD   (HL),AL63BB	CALL L635E	BIT  6,A       JR   NZ,L6420       LD   HL,0        ; размер текущего файла в блокахL63C3	EQU	$-#2	LD   DE,0L63C6	EQU	$-#2	OR   A	SBC  HL,DE	PUSH HL       CALL L64D3       ; расчёт чтения количества блоков за одну операцию	POP  DE	XOR  A	CP   D	JR   NZ,L63E2	LD   A,E	CP   L	JR   C,L6403	JR   NZ,L63E2	PUSH HL	CALL L635E	SET  6,A	LD   (HL),A	POP  HLL63E2	LD   B,L	PUSH HL       CALL L64F9       ; расчёт с какого адреса располагать данные в памяти	LD   DE,(L63C6)	LD   C,#2B	RST  #10	POP  HL	RET  C	LD   DE,(L63C6)	ADD  HL,DE	LD   (L63C6),HL	CALL L6504       JR   NZ,L63BB    ; сохранён не весь буфер в верхней памяти - переход на следующий заход	CALL L6504	XOR  A	INC  A       RETL6403	PUSH DE	CALL L635E	SET  6,A	LD   (HL),A	POP  DE	LD   B,E	PUSH DE	CALL L64F9	LD   DE,(L63C6)       LD   C,#2B        ; читаем B блоков по адресу в HL	RST  #10	POP  DE	RET  C	LD   HL,0L641A	EQU	$-#2	ADD  HL,DE	LD   (L641A),HLL6420	XOR  A       RETL6422	LD   A,(L639E)	OR   A	CALL Z,L64C5	XOR  A       CPL	LD   (L639E),A	CALL L635E	BIT  4,A	JR   NZ,L643E	SET  4,A	LD   DE,0	LD   (L6453),DEL643E	LD   (HL),A	LD   (L6479),AL6442	CALL L635E	LD   HL,(L63C6)	BIT  6,A	JR   Z,L6452	LD   HL,(L60B0)	CALL L634CL6452	LD   DE,0L6453	EQU	$-#2	OR   A	SBC  HL,DE	PUSH HL	CALL L64D3	POP  DE	XOR  A	CP   D	JR   NZ,L646F	LD   A,E	CP   L	JR   C,L6499	JR   NZ,L646F	LD   A,(L639E)	RES  6,A	LD   (L639E),AL646F	LD   B,L	PUSH HL	CALL L64F9	LD   DE,(L6453)	LD   A,#0L6479	EQU	$-#1	BIT  7,A	JR   NZ,L6481       LD   C,#2C        ; запись B блоков в открытый файл с адреса в памяти в HL по смещению в файле в байтах в DE	RST  #10L6481	POP  HL	RET  C	LD   DE,(L6453)	ADD  HL,DE	LD   (L6453),HL	CALL L6504	CALL NZ,L64DE	LD   A,(L639E)	BIT  6,A	JR   NZ,L6442       RETL6499	PUSH DE	LD   B,E	CALL L64F9	LD   DE,(L6453)	LD   A,(L6479)	BIT  7,A	JR   NZ,L64AC	LD   C,#2C	RST  #10L64AC	POP  DE	RET  C	LD   HL,(L641A)	ADD  HL,DE	LD   (L641A),HL	XOR  A       RETL64B7	XOR  A	LD   (L64DF),AL64BB	LD   A,#0L64BC	EQU	$-#1	LD   (L64D4),AL64BD	EQU	$-#3	XOR  A	LD   (L641A),A       RETL64C5	CALL L6504	CALL Z,L6504	CALL L64B7	CALL L6504	JR   L64BBL64D3	LD   HL,0L64D4	EQU	$-#2	LD   DE,(L641A)	OR   A	SBC  HL,DE       RETL64DE	LD   A,#0L64DF	EQU	$-#1	DEC  A	CALL L64EB	LD   A,(HL)	JP   L64BDL64E8	LD   A,(L64DF)L64EB	SLA  A	LD   HL,0L64EE	EQU	$-#2	LD   B,#0	LD   C,A	ADD  HL,BC	LD   E,(HL)	INC  HL	LD   D,(HL)	EX   DE,HL       RETL64F9	LD   A,(L641A)       LD   HL,0         ; здесь будет #6975L64FD  EQU  $-#2         ; адрес, с которого начинается размещение данных	LD   D,A	XOR  A	LD   E,A	ADD  HL,DE       RETL6504	LD   A,(L5DC4)	DEC  A	RET  Z	CALL L64E8	LD   B,(HL)	INC  HL	LD   E,(HL)	INC  HL	LD   D,(HL)	EX   DE,HL       CALL L635D       ; копирование 8кб буфера в верхнюю память                        ; к этому моменту вычитали в B=#20 и в HL адрес перехода       CALL L64E8       ; вычислили адрес в списке                        ; выполнили процедуру переключения страиц памяти и о,мен 8кб #6975 <-> #C000	LD   A,(HL)       CALL L64BD       ; сохранили переменные	LD   HL,(L5DC4)	LD   A,(L64DF)	INC  A	CP   L	RET  Z	LD   (L64DF),A	CALL L64E8	LD   A,(HL)	CALL L64BD	CP   #3       RETL6532	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00L653D  LD   HL,L5F53	LD   C,#4B       RST  #10         ; открываем устройство по пути из буфера	JR   NC,L655E       CP   #51         ; нет такого каталога	JR   Z,L6552       CP   #9          ; не iSDOS устройство       SCF	RET  NZ       CALL L5FE0       ; печать "Not iS-DOS"	JR   L6555L6552  CALL L5FE6       ; печать "No path"L6555  LD   A,(L5DC6)   ; восстанавливаем кэш и выходим	LD   C,#0	RST  #10	XOR  A	INC  A       RETL655E  JR   NZ,L6552    ; PRO_81       EXX              ; имя выходного файла	LD   DE,L6532	LD   BC,LB       LDIR	LD   C,#33	RST  #10       LD   (L62FD),A   ; текущий диск       EXX       LD   (L6020),HL  ; текущий каталог	XOR  A       RETL6575       CALL L67F7        ; разбросать цвета из UnCo по векторам окон       LD   A,(L5DC5)     ; макс. файлов за один заход	LD   HL,0	LD   DE,L20	LD   B,AL6582	ADD  HL,DE	DJNZ L6582	EX   DE,HL	LD   HL,L6575	ADD  HL,DE       LD   (L64FD),HL   ; HL=#6975       CALL L67A6        ; обработка параметров командной строки	RET  C	LD   C,#87	RST  #10       LD   (L6697),A    ; A-число отмеченных файлов       EXX	LD   A,H       LD   (L636E),A    ; H-максимальный номер отмеченного файла	DEC  BC       LD   A,(BC)       ; номер панели 0-левая, 1-правая	INC  BC	OR   A	JR   NZ,L65A3	INC  BCL65A3  LD   A,(BC)       ; (BC)-номер канала соответствующей панели	LD   C,#16       RST  #10          ; по номеру канала получаем данные канала	RET  C       EXX       LD   (L6023),HL   ; HL-адрес тела канала	LD   A,(HL)       LD   (L62FD),A    ; номер канала	INC  HL	LD   DE,L6020       LDI       LDI	LD   A,(HL)	LD   C,#16	RST  #10	RET  C       EXX	LD   DE,L5F53	LD   BC,L37       LDIR             ; копируем текущий путь	LD   C,#33	RST  #10       EXX	LD   (L62FC),A       LD   (L6036),HL  ; номер 0-го блока текущего каталога	LD   C,#87	RST  #10       OR   A           ; A-число отмеченных файлов в тек. панели       JR   NZ,L65F8    ; файлы отмечены-переходим	LD   C,#8A	RST  #10       LD   (L60DD),A   ; получаем номер единственного файла	LD   DE,(L60DD)	LD   C,#27       RST  #10         ; HL'-дескриптор того файла	RET  C       EXX	LD   BC,LB	ADD  HL,BC	BIT  5,(HL)       RET  NZ          ; если каталог, выходим       EXX       CALL L635E       ; получаем в HL маску отметки текущего файла       DEC  HL          ; переходим на номер отметки	SET  0,(HL)	LD   A,#1       LD   (L6697),A   ; число отмеченных файловL65F8	LD   A,#1	LD   (L6161),A	LD   (L6094),A	LD   (L639E),A	LD   IX,L66B0	LD   C,#61	XOR  A       RST  #10         ; рисуем большое фоновое окно	LD   IX,L67E7	LD   DE,L5DE5	LD   HL,L67F3	LD   A,(L60BE)       RRCA       JR   NC,L661F    ; смотрим - это copy или move	LD   HL,L67EF	INC  DEL661F	LD   A,(DE)	LD   (IX+#4),A	XOR  A       RST  #10         ; рисуем маленькое окно сверху	LD   C,#67       RST  #10         ; выводим соответствующую надпись copy/move       CALL L6555       ; уменьшаем кэш до #0C блоков	LD   C,#10       RST  #10         ; получаем в HL адрес вектора конфигурации ядра       EXX	PUSH HL	POP  IX	LD   L,(IX+#5)       LD   H,(IX+#6)   ; HL - адрес начала электронного диска       LD   DE,(L64FD)  ; адрес начала буфера для копирования	OR   A       SBC  HL,DE       ; вычисляем количество свободной памяти (буфер для копирования)L663F	LD   A,#23	RET  C       LD   A,H         ; A-количество блоков	LD   (L64BC),A	AND  A       SCF	JR   Z,L663F       CALL L6825       ; Проверка расширенной памяти       JR   Z,L6654     ; NZ - нет расширенной памяти	LD   A,#1	LD   (L5DC4),AL6654	LD   IX,L66CC	XOR  A	LD   C,#61	RST  #10       CALL L6770        ; процедура подготовки текста меню настроек	LD   HL,L66D9	LD   C,#67	RST  #10L6665  CALL L5FA1        ; подпрограмма запроса пути куда копировать	RET  C       JR   Z,L6679      ; переход, если выход по Enter       CP   #10       JP   Z,L6045      ; нажат SS/A - выходим	LD   IX,L66CC	LD   C,#91       RST  #10          ; нажат SS/SP - работаем с меню	JR   L6665L6679  CALL L6899        ; проверяем копирование на тот же диск	LD   A,(L5DC3)       AND  #8       CALL NZ,L653D     ; диски разные - открываем устройство и каталог назначения	RET  C	JR   NZ,L6665	LD   A,(L66B4)	LD   (L66D0),A	LD   A,#1	LD   C,#61	LD   IX,L66CC       RST  #10          ; стираем окно с меню       LD   DE,0         ; число отмеченных файловL6697	EQU	$-#2	XOR  A	LD   A,#3	LD   HL,L5EBD       LD   BC,LA7C      ; преобразуем количество отмеченных файлов в ascii	RST  #10	LD   IX,L5EB5       CALL L5FF5        ; вывод окошка справа с количеством файлов       CALL L5FF1        ; вывод окна с надписью SOURCE	JP   L6015L66B0       DEFB #00       DEFB #08       DEFB #10       DEFB #20L66B4       DEFB #00       DEFB #FFL66B6       DEFW L6761       DEFW L6757       DEFW L6753       DEFW L673B       DEFW L6765L66C0  DEFB #04           ; цвет курсора при отра,отке Enter       DEFB #00           ; управляющий регистр менюL66C2  DEFB #39           ; цвет курсора       DEFB #01           ; позиция курсора       DEFW L6770         ; адрес инициализации символьного массива       DEFW #0000         ; адрес программы пользователя       DEFW #0000         ; адрес списка горячих клавиш       DEFW L66B6         ; адрес списка функций отработки по клавише Enter                          ; вектор окна с менюL66CC       DEFB #09       DEFB #09       DEFB #07       DEFB #0EL66D0  DEFB #00       DEFB #FF       DEFB #0D       DEFB #11L66D4  DEFB #01       DEFB #01       DEFB #01       DEFB #01       DEFB #01L66D9  DEFM "CHANGE DISK    "L66E8  DEFB #00	DEFB	#0D       DEFM "OVERWRITE      "L66F9  DEFB #00L66FA  DEFB #0D       DEFM "ASK OVERWRITE  "L6706  EQU  $-#4L670A  DEFB #00       DEFB #0D       DEFM "BUFFER    +16 kB"L6716  EQU  $-#6L6718  EQU  $-#4       DEFB #0D       DEFM "CHANGE PATH"L6725  EQU  $-#3       DEFB #03L6729  DEFM "   OFF+16 kB+80 kB"L672A  EQU  L6729+#1L672F  EQU  L6729+#6L6734  EQU  L6729+#0BL6735  EQU  L6729+#0CL6736  EQU  L6729+#0DL673B  LD   HL,L5DC4	LD   A,(HL)	CP   #5	LD   A,#B	JR   Z,L674B	LD   A,#5	JR   C,L674B	LD   A,#1L674B	LD   (HL),A	CALL L6825L674F	JR   Z,L675E	JR   L673BL6753  LD   A,#2	JR   L6759L6757  LD   A,#1L6759	LD   HL,L5DC3	XOR  (HL)	LD   (HL),AL675E	XOR  A	INC  A       RETL6761	LD   A,#8	JR   L6759L6765       OR   #FF       RET; 0-й бит в B=1 - A="Y", B=0 - A="N"L6768  RRC  B	LD   A,#4E	RET  NC	LD   A,#59       RET; подпрограмма меню инициализации символьного массиваL6770  LD   A,(L5DC3)       LD   B,A       ; в B помещаем байт конфигурации	CALL L6768;L6775  EQU  $-#2	LD   (L66F9),A	CALL L6768;L677C  EQU  $-#1	LD   (L670A),A	RRC  B	CALL L6768       XOR  #17       ; меняем Y на N, или N на Y       LD   (L66E8),A ; помещаем результат в CHANGE DISK	LD   A,(L5DC4)	LD   DE,L6716	CP   #5	LD   HL,L6729	JR   C,L679F	LD   HL,L672F	JR   Z,L679F	LD   HL,L6735L679F	LD   BC,L6       LDIR           ; копируем строку +16 kb/+80 kb	XOR  A;L67A5       RETL67A6	LD   C,#41	RST  #10	RET  C       LD   C,#43        ; получаем в A ключ командной строки (/c,/m, т.д.)	RST  #10	RET  C	LD   C,#41       JP   NZ,#0010     ; ключа нет после восстановления возврат	OR   A       JR   Z,L67A6      ; обнаружен путь\файл       RES  5,A          ; анализируем ключи       CP   #41          ; /a/A	JR   Z,L67D3       CP   #42          ; /b/B	JR   Z,L67D8	LD   HL,L67D0       LD   BC,#0301L67C6	CP   (HL)	JR   Z,L67DF	SLA  C	INC  HL	DJNZ L67C6	JR   L67A6L67D0       DEFM "MCS"        ; возможные ключиL67D3	LD   (L5FAC),A	JR   L67A6L67D8	LD   A,#1	LD   (L5DC4),A	JR   L67A6L67DF	LD   HL,L60BE	LD   A,C	OR   (HL)       LD   (HL),A       ; с ключом /c получаем #00 OR #02	JR   L67A6L67E7	DEFB	#0D	DEFB	#06	DEFB	#03	DEFB	#06	DEFB	#00	DEFB	#FF	DEFB	#13	DEFB	#04L67EF       DEFM "MOVE"L67F3       DEFM "COPY"L67F7       LD   DE,L5DD8    ; цвета в маркере UnCo       LD   HL,L680B    ; таблица адресов, куда надо разместить цвета       LD   B,#D        ; адресов 13L67FF	LD   A,(DE)	INC  DE	PUSH DE	LD   E,(HL)	INC  HL	LD   D,(HL)	INC  HL	LD   (DE),A	POP  DE	DJNZ L67FF       RETL680B       DEFW L5EC4       DEFW L5ED2       DEFW L66B4       DEFW L66D0       DEFW L66C2       DEFW L66C0       DEFW L5E9E       DEFW L5EB1       DEFW L5EA6       DEFW L5EB9       DEFW L5F4F       DEFW L5EE5       DEFW L5EF4; подпрограмма проверки работы с расширенной памятьюL6825       LD   A,(L5DC4)       DEC  A	RET  Z	CP   #4	LD   DE,L5E53	LD   BC,(L5DC7)	LD   A,(L5DCB)	LD   HL,(L5DCD)	LD   H,#0	JR   Z,L684C	LD   DE,L5DE9	LD   BC,(L5DC9)	LD   A,(L5DCC)	LD   HL,(L5DCE)	LD   H,#C0L684C	LD   (L64EE),DE	LD   (L5E7D),BC	LD   (L5E94),A	LD   D,A	LD   E,(HL)       DI	LD   A,(HL)	DEC  (HL)	DEC  A	XOR  (HL)	LD   (HL),E	JR   NZ,L6868	LD   A,H	OR   A	JR   NZ,L6868	INC  A       EI       RETL6868	OUT  (C),L	LD   A,(HL)	DEC  (HL)	DEC  A	XOR  (HL)	OUT  (C),D       EI	RET  NZ	LD   A,(HL)	CP   E	LD   (HL),E	RET  NZ       DI	OUT  (C),L	INC  (HL)	OUT  (C),D       EI	XOR  A       RETL687F	LD   A,(L5DC4)	DEC  A	RET  Z	LD   HL,(L64EE)	LD   E,(HL)	INC  HL	LD   D,(HL)	EX   DE,HL	LD   B,A	LD   A,(L64BC)L688F	CP   (HL)	JR   NC,L6893	LD   (HL),AL6893	INC  HL	INC  HL	INC  HL	DJNZ L688F       RETL6899  LD   HL,L5F53     ; буфер путиL689C	LD   A,(HL)       CP   #3A          ; проверяем первй символ на ":"       JR   Z,L68A7      ; нашли в пути : после имени диска	CP   #D	INC  HL	JR   NZ,L689C       RETL68A7  DEC  HL	LD   A,(HL)	LD   C,#4A       RST  #10          ; преобразуем имя диска в номер диска	RET  NZ	LD   HL,L62FC       CP   (HL)         ; проверяем копирование на один и тот же диск	RET  Z	LD   HL,L5DC3       SET  3,(HL)       ; диск не один и тот же - устанавливаем бит запроса смены диска       RETLC066	EQU	#C066LD25E	EQU	#D25E