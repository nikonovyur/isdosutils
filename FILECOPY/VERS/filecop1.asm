       ORG  #5DC0L6	EQU	#6L8	EQU	#8LB	EQU	#BLC	EQU	#CLF	EQU	#FL10	EQU	#10L14	EQU	#14L20	EQU	#20L37	EQU	#37L100	EQU	#100L101	EQU	#101L202	EQU	#202L26E	EQU	#26EL301	EQU	#301L505	EQU	#505LA7C	EQU	#A7CLB00	EQU	#B00L2036	EQU	#2036L3A5E	EQU	#3A5EL3D5D	EQU	#3D5DL4000	EQU	#4000	JP   L6575L5DC3	DEFB	#03L5DC4  DEFB #0B         ; использование буфера для копированияL5DC5  DEFB #20         ; максимальное количество файлов за 1 заходL5DC6	DEFB	#0CL5DC7	DEFB	#3E	DEFB	#FFL5DC9  DEFW #7FFDL5DCB  DEFB #C0L5DCC	DEFB	#10L5DCD	DEFB	#C7; Страницы памяти буфера 80кбL5DCE  DEFB #11L5DCF  DEFB #13L5DD0  DEFB #14L5DD1  DEFB #16L5DD2  DEFB #17       DEFM "UnCo"       DEFB #11L5DD8	DEFB	#05	DEFB	#20L5DDA	DEFB	#03	DEFB	#04	DEFB	#28	DEFB	#A0	DEFB	#05	DEFB	#20	DEFB	#05	DEFB	#20	DEFB	#05	DEFB	#90	DEFB	#90L5DE5	DEFB	#04	DEFB	#03L5DE7	DEFB	#06	DEFB	#28L5DE9       DEFW L5DFF       DEFW L5E02       DEFW L5E05       DEFW L5E08       DEFW L5E0B       DEFW L5E0E       DEFW L5E11       DEFW L5E14       DEFW L5E17       DEFW L5E1A       DEFW L5DFFL5DFF       DEFB #20       DEFW L5E1DL5E02	DEFB	#20       DEFW L5E22L5E05	DEFB	#20       DEFW L5E27L5E08	DEFB	#20       DEFW L5E2CL5E0B	DEFB	#20       DEFW L5E31L5E0E	DEFB	#20       DEFW L5E36L5E11       DEFB #20       DEFW L5E3BL5E14	DEFB	#20       DEFW L5E40L5E17	DEFB	#20       DEFW L5E45L5E1A	DEFB	#20       DEFW L5E4CL5E1D       LD   A,(L5DCE)       JR   L5E48L5E22       LD   A,(L5DCE)       JR   L5E4FL5E27       LD   A,(L5DCF)       JR   L5E48L5E2C       LD   A,(L5DCF)       JR   L5E4FL5E31       LD   A,(L5DD0)       JR   L5E48L5E36       LD   A,(L5DD0)       JR   L5E4FL5E3B       LD   A,(L5DD1)       JR   L5E48L5E40       LD   A,(L5DD1)       JR   L5E4FL5E45       LD   A,(L5DD2)L5E48       LD   D,#C0       JR   L5E7AL5E4C       LD   A,(L5DD2)L5E4F       LD   D,#E0       JR   L5E7AL5E53       DEFW L5E5D       DEFW L5E60       DEFW L5E63       DEFW L5E66       DEFW L5E5DL5E5D       DEFB #10       DEFW L5E69L5E60	DEFB	#10       DEFW L5E6DL5E63	DEFB	#10       DEFW L5E71L5E66	DEFB	#10       DEFW L5E75L5E69       LD   D,#00       JR   L5E77L5E6D       LD   D,#10       JR   L5E77L5E71       LD   D,#20       JR   L5E77L5E75       LD   D,#30L5E77       LD   A,(L5DCD)L5E7A       DI       EXX       LD   BC,#0000L5E7D  EQU $-2       OUT  (C),A       EXX       LD   C,#00       LD   E,C       LD   HL,(L64FD)L5E88       LD   A,(DE)       LDI       DEC  HL       LD   (HL),A       INC  HL       LD   A,B       OR   C       JR   NZ,L5E88       EXX       LD   A,#00L5E94  EQU $-1       OUT  (C),A       EI       XOR  A       RETL5E9A  DEFB #01	DEFB	#0A	DEFB	#03	DEFB	#0EL5E9E  DEFB #00	DEFB	#FF	DEFB	#03	DEFB	#28L5EA2	DEFB	#02	DEFB	#0D	DEFB	#03	DEFB	#05L5EA6  DEFB #00	DEFB	#FF	DEFB	#04	DEFB	#03L5EAA	DEFB	#20	DEFB	#20	DEFB	#20L5EAD	DEFB	#11	DEFB	#0A	DEFB	#03	DEFB	#0EL5EB1  DEFB #00	DEFB	#FF	DEFB	#18	DEFB	#28L5EB5	DEFB	#19	DEFB	#0D	DEFB	#03	DEFB	#05L5EB9  DEFB #00	DEFB	#FF	DEFB	#23	DEFB	#03L5EBD	DEFB	#20	DEFB	#20	DEFB	#20L5EC0  DEFB #09	DEFB	#0D	DEFB	#03	DEFB	#0EL5EC4  DEFB #00	DEFB	#FF	DEFB	#12	DEFB	#06       DEFM "SOURCE"L5ECE  DEFB #09	DEFB	#0D	DEFB	#03	DEFB	#0EL5ED2  DEFB #00	DEFB	#FF	DEFB	#10	DEFB	#0B       DEFM "DESTINATION"L5EE1  DEFB #07	DEFB	#14	DEFB	#03       DEFB #13L5EE5  DEFB #00	DEFB	#FF       DEFB #0B       DEFB #16;       DEFM "No path"       DEFM "Целевой путь не найден"       DEFB #03L5EF0  DEFB #0A	DEFB	#14	DEFB	#03       DEFB #0DL5EF4  DEFB #38	DEFB	#FF       DEFB #0F       DEFB #0E;       DEFM "Not iS-DOS disk !"       DEFM "Не iS-DOS диск"       DEFB #03L5F09  DEFB #04	DEFB	#12	DEFB	#05	DEFB	#18	DEFB	#00	DEFB	#FF	DEFB	#08	DEFB	#1B       DEFM "FILE   "L5F18  DEFB #00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00       DEFM "  EXISTS"       DEFB #0D	DEFB	#0D       DEFM "   Over    Skip    Quit"       DEFB #03L5F46	DEFB	#07	DEFB	#14	DEFB	#03	DEFB	#06	DEFB	#07DESTWN       DEFB 9       DEFB 11       DEFB 7       DEFB 15       DEFB %00100000       DEFB %00000001       DEFB 13       DEFB 18       DEFM "╔═ В дисковод   ═╗"       DEFM "║ вставьте диск  ║"       DEFM "║                ║"       DEFM "║ [Enter] [SS/A] ║"       DEFM "╚════════════════╝"       DEFB #03DSTTXT       DEFM " ПРИёМНИК "SRCTXT       DEFM " ИСТОЧНИК "DSTXLN EQU  $ - SRCTXTDSKLET DEFM "  :"OWINV        DEFB 5        DEFB 12        DEFB 11        DEFB 22        DEFB %00110000        DEFB %00000001        DEFB 8        DEFB 27OVTXT        DEFM "╔════ Файл существует ════╗"        DEFM "║                         ║"        DEFM "║                         ║"        DEFM "║                         ║"        DEFM "╟─────────────────────────╢"        DEFM "║ [√] Примен. ко всем [A] ║"        DEFM "╟─────────────────────────╢"        DEFM "║ [Замена] [Проп] [Выход] ║"        DEFM "╚═════════════════════════╝"        DEFB #03OVFLGW  EQU  OVTXT + 138LTEFWN        DEFB 7        DEFB 14        DEFB 3        DEFB 18        DEFB %00001111        DEFB #FF        DEFB 10        DEFB 23OVFLG        DEFB #01OVPOS        DEFB #01OVPO01        DEFB 7        DEFB 20        DEFB 1        DEFB 7        DEFB %00101000        DEFB #FF        DEFB 10        DEFB 8OVPBTL        DEFW #1306        DEFW #0E05        DEFW #0707OVPBED; вектор окна со строкой куда копироватьL5F4B  DEFB #02	DEFB	#10	DEFB	#04	DEFB	#1CL5F4F  DEFB #00	DEFB	#FF	DEFB	#04	DEFB	#21L5F53                    ; путь куда копировать       DEFS 55	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#20	DEFB	#0DFNBUF       DEFS 69MWINV       DEFB 1       DEFB 6       DEFB 9       DEFB 30       DEFB %00111000       DEFB %00000001       DEFB 3       DEFB 37MWTXT       DEFM "╔═══════════ Копирование ═══════════╗"       DEFM "║ Копирование                       ║"       DEFM "║                                   ║"       DEFM "║                                   ║"       DEFM "╟───────────────────────────────────╢"       DEFM "║      [Enter] [SS/SP] [SS/A]       ║"       DEFM "╚═══════════════════════════════════╝"       DEFB #03MVTTLP EQU  MWTXT + 12MVTXTW EQU  MWTXT + 39MVTX2W EQU  MWTXT + 76MVBIND EQU  MWTXT + 30MVMNBT EQU  MWTXT + 200MVFRPT EQU  MWTXT + 42MVTOPT EQU  MWTXT + 79; подпрограма вывода окна с вектором в IX и установки координат печати в левый верхний уголL5F96  XOR  A	LD   C,#61	RST  #10	LD   HL,L100	LD   C,#6B	RST  #10       RETL5FA1;       LD   IX,L5F4B;       CALL L5F96       LD   IX,MWINV       LD   A,#01       LD   C,#61       ; выводим главное окно       RST  #10       LD   C,#66       ; текст главного окна       RST  #10       LD   IX,LTSWN       LD   A,#FF       LD   C,#61       ; красим область редактирования       RST  #10       LD   HL,#0000       LD   C,#6B       RST  #10       LD   HL,L5F53       LD   A,#0       ; если здесь не 0 - редактор не выводитсяL5FAC	EQU	$-#1	OR   A	JR   NZ,L5FBF	LD   A,#21	LD   DE,LB00	LD   BC,L26E	RST  #10	PUSH AF	CALL L5FC4	POP  AF       RETL5FBF	LD   C,#67	RST  #10	XOR  A       RETL5FC4	LD   A,#0L5FC5	EQU	$-#1	AND  A	RET  Z	LD   IX,L5F09	LD   A,(L5DDA)	LD   (IX+#4),A	XOR  A	LD   (L5FC5),A	INC  A	LD   C,#61	RST  #10       RET;       LD   IX,L5F4B;       JR   L5FF5L5FE0	LD   IX,L5EF0	JR   L5FEAL5FE6	LD   IX,L5EE1L5FEA	LD   A,#55	LD   (L5FC5),A	JR   L5FF5L5FF1	LD   IX,L5EC0L5FF5	XOR  A	LD   C,#61	RST  #10	LD   C,#66	RST  #10       RETL5FFD	CALL L5F96	EX   DE,HL	LD   B,#8	CALL L600C	LD   BC,L8	ADD  HL,BC	LD   B,#3L600C	LD   C,#6D	RST  #10	LD   A,#20	LD   C,#A	RST  #10       RET; процедура печати в главном окне строки "Из:"WRFRFL       LD   HL,MVFRPT       LD   (WRPTAD),HL       LD   HL,#0205       LD   (WRPTCR),HL       JR   WRFR03WRTOFL       LD   HL,MVTOPT       LD   (WRPTAD),HL       LD   HL,#0305       LD   (WRPTCR),HL;L5F53WRFR03       CALL FLPTST       RET  C       LD   DE,FNBUF       XOR  A       SBC  HL,DE       LD   A,L       CP   31       EX   DE,HL       JR   C,WRFR01       EXX       PUSH DE       EXX       POP  HL       LD   BC,30       XOR  A       SBC  HL,BC       PUSH HL       LD   B,3WRFR02       LD   (HL),"."       INC  HL       DJNZ WRFR02       POP  HLWRFR01       LD   BC,30       LD   DE,(WRPTAD)       PUSH DE       LDIR       LD   HL,(WRPTCR)       LD   C,#6B       RST  #10       POP  HL       LD   B,30       LD   C,#6D       RST  #10       RETFLPTST       LD   HL,FNBUF       LD   DE,69       XOR  A       LD   C,#47       RST  #10       RET  C       LD   C,#35       RST  #10       EXX       PUSH HL       EXX       LD   HL,FNBUF       LD   BC,69       LD   A,#20       CPIR       DEC  HL       EX   DE,HL       POP  HL       LD   C,#25       RST  #10       RET  C       LD   C,#4F       RST  #10       EXX       PUSH DE       EXX       POP  HL       LD   (HL),#20       RETLTSWCL       LD   A,(LTSWN+#04)       PUSH AF       LD   A,(MWINV+#04)       LD   (LTSWN+#04),A       LD   IX,LTSWN       LD   A,#FF       LD   C,#61       ; красим область редактирования       RST  #10       POP  AF       LD   (LTSWN+#04),A       LD   IX, MWINV       LD   C,#66       ; перевывод текста главного окна       RST  #10       RETWRPTAD DEFW #0000WRPTCR DEFW #0000BLNKWN       LD   A,(IX+#04)       PUSH AF       XOR  A       LD   (IX+#04),A       INC  A       LD   C,#61       RST  #10       POP  AF       LD   (IX+#04),A       LD   IX,MWINV       LD   A,#01       LD   C,#61       RST  #10       LD   C,#66       RST  #10       RET; подпрограмма, выводящая окна "вставьте диск"; A=0 диск ИСТОЧНИК, A<>0 диск ПРИёМНИКDSTWIN       PUSH AF       OR   A       LD   A,%00110000       JR   Z,DST01       LD   A,%00100000DST01       LD   IX,DESTWN       LD   (IX+#04),A       LD   A,#01       LD   C,#61       RST  #10       LD   C,#66       RST  #10       LD   A,#01       LD   C,#0B       RST  #10       LD   HL,#010D       LD   C,#6B       RST  #10       POP  AF       PUSH AF       OR   A       LD   HL,L62FC       JR   Z,DST02       LD   HL,L62FDDST02       LD   A,"A"       ADD  A,(HL)       LD   (DSKLET + 1),A       LD   HL,DSKLET       LD   B,#03       LD   C,#6D       RST  #10       LD   HL,#0304       LD   C,#6B       RST  #10       POP  AF       OR   A       LD   HL,SRCTXT       JR   Z,DST03       LD   HL,DSTTXTDST03       LD   B,DSTXLN       LD   C,#6D       RST  #10       XOR  A       LD   C,#0B       RST  #10       RETL6015  CALL L687F        ; странный цикл с выбором адреса списка (?)       LD   A,(CPDFLG)       OR   A       JP   NZ,COPDIR	CALL L6059	RET  C	LD   A,(L62FD)	LD   DE,0L6020	EQU	$-#2	LD   HL,0L6023  EQU  $-#2         ; адрес тела канала текущей панели	LD   (HL),A	INC  HL	LD   (HL),E	INC  HL	LD   (HL),D	INC  HL	LD   A,(L5DC3)	BIT  3,A	JR   Z,L6045	LD   A,(L62FC)	LD   DE,0L6036	EQU	$-#2	LD   B,A       LD   C,#1C       ; переключение блочных устройств	RST  #10	RET  C       LD   C,#F        ; настройка драйвера на диск	RST  #10	RET  C       LD   C,#21       ; открыть каталог	RST  #10	RET  CL6045	XOR  A       LD   A,#F6       ; выход       RETL6049	LD   C,#2	RST  #10	RET  C;       CALL L5FF1        ; вывод окна с надписью SOURCE	LD   A,(L5DC3)       BIT  3,A       JR   NZ,L6050       PUSH AF       LD   A,#01       LD   (L6055),A       XOR  A;       CALL Z,L5FF1       CALL DSTWIN       POP  AFL6050       CALL L630A        ; запрос нажатия клавиш Enter       LD   A,0L6055  EQU  $ - 1       OR   A       JR   Z,L6058       LD   IX,DESTWN       CALL BLNKWN       XOR  A       LD   (L6055),AL6058       CALL L6555L6059	LD   A,(L62FC)	LD   DE,(L6036)       CALL L637E        ; открыть диск и каталог источника	RET  C	LD   A,(L6094)L6067	LD   (L6094),A       CALL L636A        ; получили дескриптор файла       JR   NC,L6081     ; читаем следующий файл;       PUSH BC           ; прочитали все файлы;       PUSH DE;       LD   DE,L202;       LD   IX,L5E9A;       LD   C,#62        ; рисуем двойную рамку окна слева "всё прочитано";       XOR  A;       RST  #10;       POP  DE;       POP  BC	JP   L6136L6081  BIT  7,C           ; C-байт состояния отметки       JR   NZ,L6089      ; поднят 7-й бит - переходим к следующему файлу       BIT  6,C           ; проверка частичного копирования 1-продолжаем	JR   Z,L608FL6089	LD   A,(L6094)	INC  A	JR   L6067L608F	LD   (L60DD),DE	LD   DE,0L6094	EQU	$-#2	XOR  A;       LD   A,#3;       LD   HL,L5EAA;       LD   BC,LA7C     ; преобразуем номер файла для левого окна;       RST  #10;       LD   IX,L5EA2;       CALL L5FF5       ; выводим номер копируемого файла слева в окошке       CALL L6343       ; вернуть в IX адрес дескриптора, в HL - размер файла в блоках	RET  C	LD   (L63C3),HL       EXX	LD   DE,0L60B0	EQU	$-#2	LD   (L60F5),DE       LD   BC,#000C       LDIR             ; в область дескрипторов копируем дескриптор копируемого файла	DEC  DE	EX   DE,HL	LD   A,#0L60BE	EQU	$-#1       BIT  6,(HL)      ; проверяем сегментированный/непрерывный       JR   Z,L60CB     ; сегментированный - переходим       BIT  2,A         ; проверка ключа /S	JR   Z,L60D1	RES  6,(HL)	JR   L60D1L60CB  BIT  1,A         ; проверка ключа /C	JR   Z,L60D1	SET  6,(HL)L60D1	EX   DE,HL       LD   BC,#0014	INC  DE       LDIR              ; копируем остальные 20 байт дескриптора из кэша	LD   (L60B0),DE	LD   DE,0L60DD	EQU	$-#2       CALL L633E        ; открыть файл по номеру в E	RET  C       CALL L635E        ; по номеру файла в каталоге в E возвращает в A номер отметки	BIT  4,A	JR   Z,L60F0	LD   A,#0L60EB	EQU	$-#1	LD   HL,(L60F5)	LD   (HL),AL60F0;       LD   IX,L5E9A       LD   IX,MWINV	LD   DE,0L60F5	EQU	$-#2;       CALL L5FFD       ; вывод окна слева с именем читаемого файла       CALL WRFRFL       CALL L639D       ; читаем в буфер файл, если влезает, или весь буфер, если не влезает	RET  C	PUSH AF	POP  HL	LD   (L612F),HL	CALL L635E       LD   A,(L60BE)    ; проверяем бит move       RRA       JR   NC,L611F     ; если сброшен-идём дальше, иначе-удаляем	LD   A,(HL)	BIT  6,A       JR   Z,L611F      ; сброшен 6-й бит - пропускаем удаление	LD   A,(L60DD)	LD   C,#26	RST  #10	RET  C	LD   C,#3C	RST  #10	RET  C	CALL L635EL611F  RES  7,(HL)       ; отмечаем в отметке файла бит "прочитан"	LD   A,#0L6122	EQU	$-#1	INC  A	LD   (L6122),A	LD   DE,(L5DC5)       CP   E           ; сравниваем с максимальным количеством читаемых файлов       JR   Z,L6136     ; если достигли - идём на запись	LD   DE,0L612F	EQU	$-#2	PUSH DE	POP  AF       JP   Z,L6089     ; по результату L639D переходим к следующему файлуL6136  LD   A,(L60BE)   ; переходим сюда, когда надо записать файлы       RRA	JR   NC,L6140	LD   C,#2	RST  #10	RET  CL6140;       LD   IX,L5ECE;       CALL L5FF5       ; вывод окна DESTINATION	LD   A,(L5DC3)       BIT  3,A       JR   NZ,L614A       PUSH AF;       LD   IX,L5ECE;       CALL L5FF5       LD   A,#01       LD   (L6150),A       CALL DSTWIN       POP  AFL614A       BIT  2,A       JP   Z,L62DE;       JP   Z,L62DEL614F  CALL L630A       LD   A,#00L6150  EQU  $ - 1       OR   A       JR   Z,L6152       LD   IX,DESTWN       CALL BLNKWN       XOR  A       LD   (L6150),AL6152  CALL L6555       ; сброс кэша на 12 блоков	LD   A,(L62FD)	LD   DE,(L6020)       CALL L637E       ; переключение блочного устройства, открытие каталога (для записи)	RET  C	LD   A,#0L6161	EQU	$-#1	LD   (L6161),AL6162	EQU	$-#3	CALL L636A	LD   (L60DD),DE	JP   C,L629A	BIT  5,C	JP   Z,L6049	BIT  4,C	JP   NZ,L6251	LD   HL,(L60B0)	LD   A,(HL)	LD   (L60EB),AL6180  CALL L6326       ; проверяем наличие целевого файла       JP   C,L6204     ; ошибка открытия файла с именем записи - переходим       LD   A,(L5DC3)   ; здесь идёт ветка запроса перезаписи файла       RRA	JP   NC,L6292       RRA       JP   NC,L61F7;       LD   HL,(L60B0);       LD   DE,L5F18;       LD   BC,L8;       LDIR;       LD   A,#20;       LD   (DE),A;       INC  DE;       LD   C,#3;       LDIR;       LD   IX,L5F09;       LD   HL,(L5DE7);       LD   (IX+#4),L;       LD   (L5FC5),A;       CALL L5FF5;       LD   A,#1;       LD   B,H;       LD   C,#64;       RST  #10;       LD   IX,L5F46;       LD   DE,L505;       LD   L,(IX+#0);       LD   B,#3;L61C5  XOR  A;       LD   C,#62;       RST  #10;       LD   A,(IX+#0);       ADD  A,#6;       LD   (IX+#0),A;       DJNZ L61C5;       LD   (IX+#0),L;L61D6  LD   C,#8;       RST  #10;       DEC  C;       RST  #10;       CP   #73         ; "s"kip;       JP   Z,L6292;       CP   #71         ; "q"uit;       JP   Z,L629A;       CP   #53         ; "S"kip;       JP   Z,L628D;       CP   #6F         ; "o"verwrite;       JR   Z,L61F7;       CP   #4F         ; "O"verwrite;       JR   NZ,L61D6       CALL FLPTST       RET  C       LD   IX,OWINV       PUSH IX       LD   A,#01       LD   C,#61       RST  #10       LD   IX,LTEFWN       LD   A,#FF       LD   C,#61       RST  #10       LD   IX,OVPO01       LD   A,#FF       LD   C,#61       RST  #10       POP  IX       LD   C,#66       RST  #10       LD   HL,#0202       LD   (OVNFCR),HL       LD   HL,FNBUF       LD   (OVNFAD),HL       LD   B,3OVNFPR       PUSH BC       LD   HL,(OVNFCR)       LD   C,#6B       RST  #10       INC  H       LD   (OVNFCR),HL       LD   HL,(OVNFAD)       LD   B,23       LD   C,#6D       RST  #10       LD   BC,23       ADD  HL,BC       LD   (OVNFAD),HL       POP  BC       DJNZ OVNFPROVKIN       LD   C,#08       RST  #10       DEC  C       RST  #10       CP   #10       JP   Z,L629A    ; Выход       CP   "a"       JR   Z,TOGFLG       CP   "A"       JR   Z,TOGFLG       CP   #09        ; стрелка вправо       JR   Z,OVRGT       CP   #08        ; стрелка влево       JR   Z,OVLFT       CP   #0D       JP   Z,OVEND       JR   OVKINOVNFCR       DEFW #0202OVNFAD       DEFW FNBUFTOGFLG       LD   IX,OWINV       LD   HL,#0603       LD   C,#6B       RST  #10       LD   HL,OVFLG       LD   A,#01       XOR  (HL)       LD   (HL),A       LD   A,#20       JR   Z,TOGF01       LD   A,#FBTOGF01       LD   (OVFLGW),A       LD   C,#0A       RST  #10       JR   OVKINOVRGT       LD   A,(OVPOS)       CP   #03       JR   NC,OVKIN       OR   #80       CALL OVPBUT       AND  #03       INC  A       LD   (OVPOS),A       CALL OVPBUT       JR   OVKINOVLFT       LD   A,(OVPOS)       CP   #02       JP   C,OVKIN       OR   #80       CALL OVPBUT       AND  #03       DEC  A       LD   (OVPOS),A       CALL OVPBUT       JP   OVKINOVPBUT       LD   IX,OVPO01       LD   HL,OVPBED       LD   B,A       RES  7,B       PUSH AFOVPB01       DEC  HL       DEC  HL       DJNZ OVPB01       AND  #80       LD   A,%00101000  ; цвет подсветки кнопок, заменить на цвет из UnCo       JR   Z,OVPB02       LD   A,(OWINV+#04)OVPB02       LD   (IX+#04),A       LD   A,(HL)       LD   (IX+#03),A       INC  HL       LD   A,(HL)       LD   (IX+#00),A       LD   A,#FF       LD   C,#61       RST  #10       POP  AF       RETOVEND       LD   A,(OVPOS)       CP   #03       JP   Z,L629A       LD   IX,OWINV       CALL BLNKWN       LD    A,(OVFLG)       OR   A       LD   A,(OVPOS)       JR   NZ,OVEN01       CP   #02       JP   Z,L6292       JR   L61F7OVEN01                  ; флажок "применить ко всем" поднят       CP   #02       JP   Z,L628DL61F2                   ; Overwrite all	LD   HL,L5DC3	RES  1,(HL)L61F7	LD   C,#35	RST  #10       EXX	XOR  A	LD   (HL),A	LD   C,#28	RST  #10	RET  C	JP   L6180L6204  CP   #51         ; проверяем код ошибки 81 - файл не существует       SCF       RET  NZ          ; на выход с ошибкой, если ошибка другая	LD   HL,(L60B0)       LD   C,#50       ; проверяем на корректность имя файла	XOR  A	RST  #10	RET  C	PUSH HL       LD   BC,#000F	ADD  HL,BC	LD   E,(HL)	INC  HL	LD   D,(HL)	LD   (HL),B	LD   (L623A),HL	INC  D	DEC  D	JR   NZ,L622B	LD   A,E	INC  A	JR   Z,L622B	POP  HL       LD   C,#3B       ; создание целевого файла	RST  #10	RET  C	JR   L6251L622B	DEC  HL	RES  7,(HL)	DEC  HL	DEC  HL	DEC  HL	DEC  HL	LD   (HL),#1	POP  HL       LD   C,#3B       ; создание целевого файла	RST  #10	RET  C	LD   HL,0L623A	EQU	$-#2	LD   (HL),D	DEC  HL	LD   (HL),E	LD   A,E	AND  #80	OR   D	JR   Z,L6251       RLCA       RLCA	LD   B,AL6248	LD   DE,L4000       LD   C,#31        ; добавить в конец файла DE байт	RST  #10	RET  C	DJNZ L6248L6251  CALL L6326        ; открываем файл по имени	RET  CL6255  CALL L5FC4        ; стираем окно Over-Skip-Quit	CALL L6422	RET  C	CALL L635E	BIT  7,A	JR   NZ,L6279;       PUSH AF       LD   (STA01),A;       LD   IX,L5EAD;       LD   DE,(L60B0);       CALL L5FFD        ; рисуем правое окно с записываемым файлом       LD   HL,(L60B0)       LD   C,#25       RST  #10       RET  C       LD   IX,MWINV       CALL WRTOFL       LD   A,#00STA01  EQU  $ -1;       POP  AF	BIT  6,A	JP   Z,L6049       CALL L6326        ; открываем записаный файл по имени	RET  CL6279	LD   A,(L6161)	LD   HL,(L60B0)	LD   BC,L20	ADD  HL,BC	LD   (L60B0),HL	INC  A	LD   (L6161),A	JP   L6162L628D  LD   HL,L5DC3     ; Перезаписать все	RES  0,(HL)L6292  CALL L635E        ; перезаписать файл	SET  7,A	LD   (HL),A	JR   L6255L629A	LD   C,#2	RST  #10	RET  C	CALL L62A4	RET  C	XOR  A       RETL62A4	LD   DE,0L62A7	LD   (L60DD),DE	CALL L6343	JR   C,L62D0	LD   A,(IX+#B)       RRA	JR   NC,L62C2	PUSH IX	POP  HL	XOR  A	CP   (HL)	JR   NZ,L62C2	LD   C,#24	RST  #10	JR   C,L62D0L62C2	LD   DE,(L60DD)	INC  DE	LD   A,#7F	CP   E	JR   NZ,L62A7L62CC	LD   C,#2	RST  #10       RETL62D0	CP   #59	JR   Z,L62C2	CP   #50	JR   Z,L62CC	CP   #65	JR   Z,L62CC       SCF       RETL62DE	SET  2,A	LD   (L5DC3),A       CALL L630A       ; если поднят флаг, запрашиваем нажатия клавиш       JR   NZ,L6307    ; кнопки не нажимали, преходим       CALL L6555       ; пересоздание кэшаL62EB	CALL L653D	RET  C	JR   Z,L62F8	CALL L5FA1	RET  C       PUSH AF       CALL LTSWCL       POP  AF	JR   Z,L62EB       RETL62F8;      CALL L5FC4	LD   HL,0L62FC  EQU  $-#2        ; номер диска откуда копировать	LD   A,LL62FD  EQU  $-#2        ; номер диска куда копировать	SUB  H	JR   Z,L6307	LD   HL,L5DC3	SET  3,(HL)L6307	JP   L6152L630A	BIT  3,A	RET  NZL630D  LD   C,#8        ; обработка нажатий клавиш, например, при смене дисков	RST  #10	DEC  C	RST  #10	CP   #D	RET  Z	CP   #17	JR   Z,L6320	CP   #10	JR   NZ,L630D	LD   C,#80	RST  #10L6320	LD   HL,L5DC3	SET  3,(HL)	RET  ZL6326	LD   HL,(L60B0)	PUSH HL	LD   DE,L6532	LD   B,#BL632F	LD   A,(DE)       CP   #FF         ; проверяем файл по маске	JR   Z,L6335	LD   (HL),AL6335	INC  HL	INC  DE	DJNZ L632F	POP  HL       LD   C,#34       ; пробуем перед записью файла открыть файл с этим именем	RST  #10       RETL633E	LD   A,E	LD   C,#26	RST  #10       RETL6343	LD   DE,(L60DD)	LD   C,#27	RST  #10	RET  C       EXXL634C	PUSH HL       EXX	POP  IX	LD   L,(IX+#F)	LD   H,(IX+#10)	LD   A,(IX+#E)	OR   A	RET  Z	INC  HL       RETL635D	JP   (HL); L60DD - номер файла в каталоге; возвращает в HL-адрес байта состояния отметки файлаL635E  LD   DE,(L60DD)L6362	LD   C,#86	RST  #10       EXX	PUSH HL       EXX	POP  HL       RET; Подпрограмма принимает номер отмеченного файла; возвращает в HL-дескриптор, C-байт состоянияL636A  LD   B,A	XOR  A	LD   E,A; перебираем файлы в каталоге, ищем следующий файлL636D  LD   A,#0         ; максимальный номер файла в каталогеL636E	EQU	$-#1	CP   E       RET  C            ; возвращаемся, если список файлов закончился	PUSH BC	CALL L6362	POP  BC	LD   C,(HL)	DEC  HL	LD   A,(HL)	CP   B       RET  Z            ; возвращаемся, если нашли файл	INC  E	JR   L636DL637E	LD   B,A       LD   C,#1C        ; переключить блочное устройство	RST  #10	RET  C	LD   A,(L5DC3)	BIT  3,A	JR   NZ,L638E       LD   C,#F         ; диск тотже - автонастройка диска	RST  #10	RET  CL638E  LD   C,#21        ; открыть каталог	RST  #10	RET  C	XOR  A	LD   (L6122),A	LD   HL,L6575	LD   (L60B0),HL       RETL639D	LD   A,#FFL639E	EQU	$-#1	OR   A       CALL NZ,L64B7    ; обнулили переменные	LD   (L639E),A       CALL L635E       ; получили в A байт состояния отметки	RES  7,A       BIT  5,A         ; сброшен 5-й бит - устанавливаем 5-й, 7-й биты	JR   NZ,L63BA	SET  5,A	SET  7,A	LD   DE,0	LD   (L63C6),DEL63BA	LD   (HL),AL63BB	CALL L635E	BIT  6,A       JR   NZ,L6420       LD   HL,0        ; размер текущего файла в блокахL63C3	EQU	$-#2	LD   DE,0L63C6  EQU  $-#2        ; с какого блока читаем открытый файл	OR   A	SBC  HL,DE	PUSH HL       CALL L64D3       ; расчёт чтения количества блоков за одну операцию размер в блоках в HL       POP  DE          ; количество блоков файла, которые надо прочитать	XOR  A	CP   D       JR   NZ,L63E2    ; в D не 0 - файл длиннее 255 блоков	LD   A,E	CP   L       JR   C,L6403     ; остаток файла меньше размера буфера       JR   NZ,L63E2    ; остаток файла больше размера буфера       PUSH HL          ; равен размеру буфера	CALL L635E	SET  6,A	LD   (HL),A	POP  HLL63E2	LD   B,L	PUSH HL       CALL L64F9       ; расчёт с какого адреса располагать данные в памяти	LD   DE,(L63C6)	LD   C,#2B	RST  #10	POP  HL	RET  C	LD   DE,(L63C6)	ADD  HL,DE	LD   (L63C6),HL       CALL L6504       ; обмен 8кб из буфера с расширенной памятью       JR   NZ,L63BB    ; сохранён не весь буфер в верхней памяти - переход на следующий заход	CALL L6504	XOR  A	INC  A       RETL6403	PUSH DE	CALL L635E	SET  6,A	LD   (HL),A	POP  DE	LD   B,E	PUSH DE	CALL L64F9	LD   DE,(L63C6)       LD   C,#2B        ; читаем B блоков по адресу в HL	RST  #10	POP  DE	RET  C	LD   HL,0L641A	EQU	$-#2	ADD  HL,DE	LD   (L641A),HLL6420	XOR  A       RETL6422	LD   A,(L639E)	OR   A	CALL Z,L64C5	XOR  A       CPL	LD   (L639E),A	CALL L635E	BIT  4,A	JR   NZ,L643E	SET  4,A	LD   DE,0	LD   (L6453),DEL643E	LD   (HL),A	LD   (L6479),AL6442	CALL L635E	LD   HL,(L63C6)	BIT  6,A	JR   Z,L6452	LD   HL,(L60B0)	CALL L634CL6452	LD   DE,0L6453	EQU	$-#2	OR   A	SBC  HL,DE	PUSH HL	CALL L64D3	POP  DE	XOR  A	CP   D	JR   NZ,L646F	LD   A,E	CP   L	JR   C,L6499	JR   NZ,L646F	LD   A,(L639E)	RES  6,A	LD   (L639E),AL646F	LD   B,L	PUSH HL	CALL L64F9	LD   DE,(L6453)	LD   A,#0L6479	EQU	$-#1	BIT  7,A	JR   NZ,L6481       LD   C,#2C        ; запись B блоков в открытый файл с адреса в памяти в HL по смещению в файле в байтах в DE	RST  #10L6481	POP  HL	RET  C	LD   DE,(L6453)	ADD  HL,DE	LD   (L6453),HL	CALL L6504	CALL NZ,L64DE	LD   A,(L639E)	BIT  6,A	JR   NZ,L6442       RETL6499	PUSH DE	LD   B,E	CALL L64F9	LD   DE,(L6453)	LD   A,(L6479)	BIT  7,A	JR   NZ,L64AC	LD   C,#2C	RST  #10L64AC	POP  DE	RET  C	LD   HL,(L641A)	ADD  HL,DE	LD   (L641A),HL	XOR  A       RETL64B7	XOR  A	LD   (L64DF),AL64BB	LD   A,#0L64BC	EQU	$-#1	LD   (L64D4),AL64BD	EQU	$-#3	XOR  A	LD   (L641A),A       RETL64C5	CALL L6504	CALL Z,L6504	CALL L64B7	CALL L6504	JR   L64BBL64D3	LD   HL,0L64D4	EQU	$-#2	LD   DE,(L641A)	OR   A	SBC  HL,DE       RETL64DE	LD   A,#0L64DF	EQU	$-#1	DEC  A	CALL L64EB	LD   A,(HL)       JR   L64BDL64E8	LD   A,(L64DF)L64EB	SLA  A	LD   HL,0L64EE	EQU	$-#2	LD   B,#0	LD   C,A	ADD  HL,BC	LD   E,(HL)	INC  HL	LD   D,(HL)	EX   DE,HL       RETL64F9	LD   A,(L641A)       LD   HL,0         ; здесь будет #6975L64FD  EQU  $-#2         ; адрес, с которого начинается размещение данных	LD   D,A	XOR  A	LD   E,A	ADD  HL,DE       RETL6504	LD   A,(L5DC4)	DEC  A	RET  Z	CALL L64E8	LD   B,(HL)	INC  HL	LD   E,(HL)	INC  HL	LD   D,(HL)	EX   DE,HL       CALL L635D       ; копирование 8кб буфера в верхнюю память                        ; к этому моменту вычитали в B=#20 и в HL адрес перехода       CALL L64E8       ; вычислили адрес в списке                        ; выполнили процедуру переключения страиц памяти и обмен 8кб #6975 <-> #C000	LD   A,(HL)       CALL L64BD       ; сохранили переменные	LD   HL,(L5DC4)	LD   A,(L64DF)	INC  A	CP   L	RET  Z	LD   (L64DF),A	CALL L64E8	LD   A,(HL)	CALL L64BD	CP   #3       RETL6532	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00	DEFB	#00L653D  LD   HL,L5F53	LD   C,#4B       RST  #10         ; открываем устройство по пути из буфера	JR   NC,L655E       CP   #51         ; нет такого каталога	JR   Z,L6552       CP   #9          ; не iSDOS устройство       SCF	RET  NZ       CALL L5FE0       ; печать "Not iS-DOS"	JR   L6555L6552  CALL L5FE6       ; печать "No path"L6555  LD   A,(L5DC6)   ; восстанавливаем кэш и выходим	LD   C,#0	RST  #10	XOR  A	INC  A       RETL655E  JR   NZ,L6552    ; PRO_81       EXX              ; имя выходного файла	LD   DE,L6532	LD   BC,LB       LDIR       LD   C,#33	RST  #10       LD   (L62FD),A   ; текущий диск       EXX       LD   (L6020),HL  ; текущий каталог	XOR  A       RETCOPDIR       LD   A,(L62FC)       LD   DE,(L6036)       CALL L637E        ; открыть диск и каталог источника       RET  C       LD   A,(L64BC)       LD   (BUFBLK),A   ; инициализируем количество свободных блоков размером буфера       LD   A,(L60DD)       LD   C,#26       RST  #10       RET  C       EXX       PUSH HL       CALL FDREAD       POP  HL       JP   C,RECD4RECD11       PUSH HL       DEC  HL       LD   A,(HL)       ; получаем номер текущего каталога в каталоге уровнем выше       CALL RECD10       LD   (HL),A       ; запоминаем номер в мвссиве       LD   IX,MWINV       CALL WRFRFL       POP  HL       LD   BC,#0013     ; номер 0-го блока каталога по смещению 19       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       LD   C,#21       RST  #10       RET  C       LD   HL,CRLVL       INC  (HL)RECD12                   ; заходим сюда из процедуры записи       CALL RECD10RECD1       LD   A,(HL)       LD   C,#26       RST  #10       JP   NC,RECD3       CP   #50          ; проверяем на ошибку 80 (выход за список каталога)       SCF       RET  NZ; ветка возвращения на уровень выше и удаления каталога из которого вышли       XOR  A            ; перебрали все файлы в каталоге, возвращаемся на уровень выше       LD   C,#26       RST  #10       RET  C       EXX       LD   BC,#000C       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       LD   C,#21       RST  #10       RET  C       LD   HL,(FDCUR)       LD   DE,#0019       OR   A       ADC  HL,DE       INC  (HL)       CALL RECD10       LD   (HL),#00       LD   HL,CRLVL       DEC  (HL)       JP   Z,WECD      ; вернулись на 0-й уровень                        ; обошли все файлы, финальная запись       JP   RECD2       ; возвращаемся на уровень выше, переходим к следующему файлуRECD3       OR   A       JP   Z,RECD2     ; открыли файл с номером 0, это текущий каталог; здесь открыт файл и с ним можно проводить действия; HL'-адрес системного дескриптора открытого файла       EXX       PUSH HL       LD   BC,#000B       ADD  HL,BC       LD   A,(HL)       POP  HL       BIT  0,A         ; файл не удалён?       JP   Z,RECD2     ; файл/каталог удалён, пропускаем; здесь должно быть копирование дескриптора файла/каталога в массив; сохранить A и HL       PUSH HL       LD   B,A       PUSH BC       CALL FDREAD       POP  BC       LD   A,B       POP  HL       JP   C,WECD      ; достигнут предел количества считанных дескрипторов (32) - переход на запись       BIT  5,A         ; проверяем-открытый файл каталог?       JP   NZ,RECD11RECD33       PUSH HL       LD   A,(BUFBLK)       LD   B,A       LD   A,(L64BC)       SUB  B       LD   D,A       XOR  A       LD   E,A       LD   HL,(L64FD)       ADD  HL,DE       ; вычисляем адрес куда считывать       EX   DE,HL       POP  HL       PUSH HL       PUSH DE       CALL L634C       ; вычисляем размер в блоках текущего открытого файла       PUSH HL          ; запоминаем в стеке       LD   HL,(FDNXT)       LD   DE,#0020       OR   A       SBC  HL,DE       LD   DE,(FDSTT)       OR   A       SBC  HL,DE       POP  HL          ; вспомнили размер файла в блоках       LD   DE,#0000       LD   A,#00       JR   NZ,RECD37   ; если дескриптор первый, используем переменную FSTBLK       LD   DE,(FSTBLK)       OR   A       SBC  HL,DE       LD   A,#FFRECD37       LD   (FSTFLG),A       PUSH DE       LD   A,H       OR   A       JR   NZ,RECD35   ; переход, если остаток блоков больше 255       LD   A,(BUFBLK)       CP   L       JR   C,RECD35       LD   B,L         ; ветка, где остаток буфера больше остатка файла       SUB  B       LD   (BUFBLK),A  ; после расчёта количества считываемых блоков вычисляем остаток буфера       LD   HL,#0000       LD   (LSTBLK),HL ; обнуляем остаток блоков файла - файл влезает в буфер весь       JR   RECD36RECD35                  ; ветка, где остаток буфера меньше остатка файла       LD   A,(FSTFLG)       OR   A       LD   HL,#0000       JR   Z,RECD38    ; если дескриптор первый, то уже заход не первый       LD   HL,(FSTBLK) ;RECD38       LD   A,(BUFBLK)       LD   B,A       LD   E,A       LD   D,0       ADD  HL,DE       LD   (LSTBLK),HL       XOR  A       LD   (BUFBLK),A  ; обнуляем остаток буфераRECD36                  ; подходим к процедуре чтения       POP  DE       POP  HL       LD   C,#2B       RST  #10       POP  HL           ; вспоминаем адрес дескриптора       RET  C       LD   IX,MWINV       LD   A,(FSTFLG)       OR   A       CALL Z,WRFRFL       ; адрес дескриптора нужен для вывода имени копируемого файла       LD   A,(BUFBLK)       OR   A       JR   Z,WECD       ; буфер забит, нужен переход на процедуру записиRECD2                 CALL RECD10       INC  (HL)       JP   RECD1RECD4;       LD   C,#02;       RST  #10;       RET  C;       LD   IX,SREDA;       XOR  A;       LD   C,#37;       RST  #10       LD   C,#10       RST  #10       EXX       LD   BC,#FFFA       ADD  HL,BC       LD   A,(HL)       LD   C,#00       RST  #10       RET  C       JP   L6045; Процедура записиWECD       LD   C,#33       RST  #10       EXX       LD   (L6036),HL       LD   A,(L62FD)       LD   DE,(L6020)       CALL L637E       RET  C       LD   A,(L64BC)       LD   (BUFBLK),A       LD   HL,(FDSTT)WENX01       LD   (FDWRI),HL       PUSH HL       LD   BC,#0019       ADD  HL,BC       LD   A,(HL)       LD   (DEPB25),A       LD   (HL),#00       POP  HL       LD   BC,#000B       ADD  HL,BC       BIT  5,(HL)       JP   Z,WECDFL; дескриптор каталога       LD   HL,(FDWRI)       LD   C,#25       RST  #10       JP   NC,WECD01       CP   #51       SCF       RET  NZ       LD   HL,(FDWRI)       PUSH HL       LD   BC,#000C       PUSH BC       ADD  HL,BC       XOR  A       LD   (HL),A       INC  HL       LD   (HL),A       LD   BC,#0004       ADD  HL,BC       LD   D,H       LD   E,L       INC  DE       POP  BC       LD   (HL),A       LDIR       POP  HL; Процедура создания, HL - адрес дескриптора;MKDIR       PUSH HL       POP  IX       LD   C,#23        ; Создаём каталог       RST  #10       RET  C       EXX       LD   BC,#000B       ADD  HL,BC       LD   A,(HL)       ; A - регистр состояния       LD   C,#6       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       ; DE - номер блока описателя сегментов       AND  #40          ; Проверка 6-го бита непрерывный ли файл?       JR   NZ,MKD01     ; каталог непрерывный - переходим       RST  #10          ; блок номер DE считываем в кэш       RET  C       EXX       INC  HL       LD   E,(HL)       INC  HL       LD   D,(HL)       PUSH DE       EXX       POP  DEMKD01  INC  HL       LD   (HL),E       INC  HL       LD   (HL),D       LD   C,#28       RST  #10       RET  C       PUSH DE       LD   BC,#FFEC       ADD  HL,BC       LD   BC,#0020       PUSH IX       POP  DE       LDIR             ; копируем в локальный дескриптор внутренний дескриптор с обновлёнными данными       LD   C,#10       ; далее заполняем дескриптор дефолтным содержимым (1 элемент каталога и т.д. )       ADD  HL,BC       LD   A,(HL)       INC  HL       INC  HL       INC  HL       LD   E,(HL)       INC  HL       LD   D,(HL)       INC  HL       INC  HL       INC  HL       OR   (HL)       INC  A       LD   (IX+#0C),E       LD   (IX+#0D),D       LD   (IX+#17),A       LD   (IX+#15),#01       POP  DE       LD   C,#6        ; считываем первый блок каталога       RST  #10       RET  C       EXX       PUSH DE       EX   DE,HL       PUSH IX       POP  HL       LD   BC,#0020       LDIR             ; заполняем первый элемент каталога своим же дескриптором       LD   C,#DF       LD   L,E       LD   H,D       INC  DE       LD   (HL),#0       LDIR             ; остальная часть блока - нули       POP  DE       LD   C,#2E       ; помечаем блок в кэше как модифицированный       RST  #10       RET  C; В регистре A - вычисляем количество блоков, подлежащих забивке нулями       LD   L,(IX+#0E)       LD   H,(IX+#0F)       LD   A,L       OR   A       LD   A,H       JR   NZ,MKD02       DEC  AMKD02  OR   A       JR   Z,MKD05       LD   B,A       LD   DE,#0001; цикл забивки нулями блоков каталога, следующих за первымMKD03  LD   C,#2D      ; читаем блок в кэш       RST  #10       RET  C       EXX             ; получаем в HL' адрес блока в кэше       XOR  A       LD   B,AMKD04  LD   (HL),A     ; пишем в блок нули       INC  HL       DJNZ MKD04       PUSH DE       EXX       POP  HL       EX   DE,HL       LD   C,#2E      ; помечаем блок в кэше как модифицированный       RST  #10       RET  C       EX   DE,HL       INC  DE       DJNZ MKD03MKD05       LD   C,#2       RST  #10       RET  C       LD   IX,MWINV       CALL WRTOFL       ; адрес дескриптора нужен для вывода имени копируемого файла       LD   HL,(FDWRI)       LD   BC,#0013       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       LD   C,#21       RST  #10       RET  C       JP   WECDNXWECD01       OR   A       SCF       RET  Z       JP   WECDNX; дескриптор файлаWECDFL       LD   IX,(FDWRI)       XOR  A       LD   (IX+#11),A       LD   (IX+#12),A       PUSH IX       POP  HL       LD   C,#25       RST  #10       JR   NC,WECDF2WECDF1       CP   #51       SCF       RET  NZ       LD   HL,(FDWRI)       PUSH HL       LD   BC,#000B       ADD  HL,BC       XOR  A       LD   D,#00       BIT  6,(HL)      ; если файл непрерывный, манипуляции с добавлением блоков не делаем       JR   NZ,WCDF13       LD   BC,#0004       ADD  HL,BC       LD   E,(HL)       RES  7,(HL)       INC  HL       LD   D,(HL)       LD   (HL),#00       LD   A,E       AND  #80WCDF13       OR   D       POP  HL       PUSH AF       LD   C,#3B       RST  #10       POP  BC       RET  C       PUSH BC       POP  AF       JR   Z,WCDF11       RLCA       RLCA       LD   B,AWCDF12       LD   DE,#4000       LD   C,#31       RST  #10       DJNZ WCDF12WCDF11       LD   C,#02       RST  #10       RET  CWECDF2       LD   HL,(FDWRI)       PUSH HL       LD   A,(BUFBLK)       LD   B,A       LD   A,(L64BC)       SUB  B       LD   D,A       XOR  A       LD   E,A       LD   HL,(L64FD)       ADD  HL,DE       ; вычисляем адрес куда считывать       EX   DE,HL       POP  HL       PUSH HL       PUSH DE       CALL L634C       ; вычисляем размер в блоках текущего открытого файла       PUSH HL          ; запоминаем в стеке       LD   HL,(FDWRI)       LD   DE,(FDSTT)       OR   A       SBC  HL,DE       POP  HL          ; вспомнили размер файла в блоках       LD   DE,#0000;       LD   A,#00       JR   NZ,WECF01   ; если дескриптор первый, используем переменную FSTBLK       LD   DE,(FSTBLK)       OR   A       SBC  HL,DE;       LD   A,#FFWECF01;       LD   (FSTFLG),A       PUSH DE       LD   A,H       OR   A       JR   NZ,WECF02   ; переход, если остаток блоков больше 255       LD   A,(BUFBLK)       CP   L       JR   C,WECF02       LD   B,L         ; ветка, где остаток буфера больше остатка файла       SUB  B       LD   (BUFBLK),A  ; после расчёта количества считываемых блоков вычисляем остаток буфера;       LD   HL,#0000;       LD   (LSTBLK),HL ; обнуляем остаток блоков файла - файл влезает в буфер весь       JR   WECF03WECF02;       LD   A,(FSTFLG);       OR   A;       LD   HL,#0000;       JR   Z,RECD38    ; если дескриптор первый, то уже заход не первый;       LD   HL,(FSTBLK) ;;RECD38       LD   A,(BUFBLK)       LD   B,A;       LD   E,A;       LD   D,0;       ADD  HL,DE;       LD   (LSTBLK),HL       XOR  A       LD   (BUFBLK),A  ; обнуляем остаток буфераWECF03       POP  DE       POP  HL       LD   C,#2C       RST  #10       POP  HL           ; вспоминаем адрес дескриптора       RET  C       LD   IX,MWINV       CALL WRTOFLWECDNX       LD   A,(DEPB25)       OR   A       JR   Z,WECNX1WECNX2       XOR  A       LD   C,#26       RST  #10       RET  C       EXX       LD   BC,#000C       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       LD   C,#21       RST  #10       RET  C       LD   HL,DEPB25       DEC  (HL)       JR   NZ,WECNX2WECNX1       LD   HL,(FDWRI)       LD   DE,#0020       ADD  HL,DE       EX   DE,HL       LD   HL,(FDCUR)       OR   A       SBC  HL,DE       EX   DE,HL       JP   NC,WENX01       LD   C,#33       RST  #10       EXX       LD   (L6020),HL       LD   A,(L62FC)       LD   DE,(L6036)       CALL L637E       RET  C       LD   HL,(FDSTT)       LD   (FDNXT),HL       LD   HL,#0000       LD   (FDCUR),HL       LD   A,(L64BC)       LD   (BUFBLK),A       LD   HL,(LSTBLK)       LD   (FSTBLK),HL       LD   A,(CRLVL)       OR   A       JP   Z,RECD4       JP   RECD12RECD10       LD   HL,CRLVL       LD   C,(HL)       INC  HL       LD   B,(HL)       LD   HL,FNLVL       ADD  HL,BC       RETFDREAD       PUSH HL       LD   HL,(FDEND)       LD   DE,(FDNXT)       OR   A       SBC  HL,DE       POP  HL       JR   Z,FDRD3       RET  C       LD   (FDCUR),DE       LD   BC,#000C       LDIR             ; в область дескрипторов копируем дескриптор копируемого файла       DEC  DE       EX   DE,HL       LD   A,(L60BE)       BIT  6,(HL)      ; проверяем сегментированный/непрерывный       JR   Z,FDRD1     ; сегментированный - переходим       BIT  2,A         ; проверка ключа /S       JR   Z,FDRD2       RES  6,(HL)       JR   FDRD2FDRD1  BIT  1,A         ; проверка ключа /C       JR   Z,FDRD2       EX   DE,HL       PUSH HL       LD   BC,#0004       ADD  HL,BC       LD   A,(HL)      ; смотрим старший байт длины в дескрипторе       OR   A           ; если не 0-файл непрерывным не делаем       POP  HL       EX   DE,HL       JR   NZ,FDRD2       SET  6,(HL)FDRD2  EX   DE,HL       LD   BC,#0014       INC  DE       LDIR              ; копируем остальные 20 байт дескриптора из кэша       LD   (FDNXT),DE       EX   DE,HL        ; обнуляем байт по смещению +25       LD   DE,#0007       XOR  A       SBC  HL,DE       LD   (HL),A       RETFDRD3  SCF       RETCRLVL  DEFW #0000        ; уровень вложенности каталогаFNLVL  DEFS 9            ; номера файлов на разных уровнях вложенностиSREDA  DEFS 4            ; сохранённая средаBLKSM  DEFW #0000        ; подсчитанный объём блоков для копированияFDSTT  DEFW #0000        ; начало массива с дескрипторами (L6575)FDCUR  DEFW #0000        ; адрес текущего файлового дескриптора в массивеFDNXT  DEFW #0000        ; адрес следующего дескриптора в массивеFDEND  DEFW #0000        ; адрес начала буфера для копированияFDWRI  DEFW #0000        ; адрес текущего записываемого дескриптораBUFBLK DEFB #00          ; количество свободных блоков в буфере памятиFSTBLK DEFW #0000        ; количество прочитанных блоков первого файла в массивеLSTBLK DEFW #0000        ; количество прочитанных блоков последнего файла в массивеCURSBL DEFW #0000        ; 0-й блок текущего исходного каталогаCURDBL DEFW #0000        ; 0-й блок текущего приёмного каталогаFSTFLG DEFB #00          ; флаг первого дескриптора в массивеDEPB25 DEFB #00          ; байт 25, показывает, на сколько уровней вернутьсяL6575       CALL L67F7        ; разбросать цвета из UnCo по векторам окон       LD   A,(L5DC5)     ; макс. файлов за один заход	LD   HL,0	LD   DE,L20	LD   B,AL6582	ADD  HL,DE	DJNZ L6582	EX   DE,HL       LD   HL,L6575       LD   (FDSTT),HL       LD   (FDNXT),HL	ADD  HL,DE       LD   (L64FD),HL   ; HL=#6975       LD   (FDEND),HL       CALL L67A6        ; обработка параметров командной строки	RET  C	LD   C,#87	RST  #10       LD   (MRKFLS),A    ; A-число отмеченных файлов       EXX	LD   A,H       LD   (L636E),A    ; H-максимальный номер отмеченного файла	DEC  BC       LD   A,(BC)       ; номер панели 0-левая, 1-правая	INC  BC	OR   A	JR   NZ,L65A3	INC  BCL65A3  LD   A,(BC)       ; (BC)-номер канала соответствующей панели	LD   C,#16       RST  #10          ; по номеру канала получаем данные канала	RET  C       EXX       LD   (L6023),HL   ; HL-адрес тела канала	LD   A,(HL)       LD   (L62FD),A    ; номер канала	INC  HL	LD   DE,L6020       LDI       LDI	LD   A,(HL)	LD   C,#16	RST  #10	RET  C       EXX	LD   DE,L5F53	LD   BC,L37       LDIR             ; копируем текущий путь	LD   C,#33	RST  #10       EXX	LD   (L62FC),A       LD   (L6036),HL  ; номер 0-го блока текущего каталога       LD   A,(L60BE)       RRCA       JR   NC,COPCNT    ; смотрим - это copy или move       LD   HL,MWTXT+47       LD   (MWTXDS),HL                         ; Меняем заголовок окна       LD   HL,MOVTTL       LD   BC,MOVTLN       LD   DE,MVTTLP       LDIR                         ; Меняем надпись в окне       LD   HL,MOVTXT       LD   BC,MVTXLN       LD   DE,MVTXTW       LDIR                         ; Добиваем пробелами надпись       LD   H,D       LD   L,E       DEC  HL       LD   BC,#0004       LDIRCOPCNT       LD   A,(MRKFLS)       OR   A           ; A-число отмеченных файлов в тек. панели       JP   NZ,FLMRKD   ; файлы отмечены-переходим       LD   C,#8A	RST  #10       LD   (L60DD),A   ; получаем номер единственного файла	LD   DE,(L60DD)	LD   C,#27       RST  #10         ; HL'-дескриптор того файла	RET  C       EXX       PUSH HL       LD   BC,#000B	ADD  HL,BC	BIT  5,(HL); если каталог, выходим;       RET  NZ       POP  HL       JP   Z,COPC01       LD   A,#01       LD   (CPDFLG),A       XOR  A       LD   IX,SREDA       LD   C,#36       RST  #10                          ; каталог не пуст, требуется проверка на флаг и рекурсивное удаление       LD   A,(L60DD)       LD   C,#26       RST  #10       RET  C       EXXCRECD11       PUSH HL       DEC  HL       LD   A,(HL)       ; получаем номер текущего каталога в каталоге уровнем выше       CALL RECD10       LD   (HL),A       ; запоминаем номер в мвссиве       POP  HL       LD   BC,#0013     ; номер 0-го ,лока каталога по смещению 19       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       LD   C,#21       RST  #10       RET  C       LD   HL,CRLVL       INC  (HL)       CALL RECD10DRECD1       LD   A,(HL)       LD   C,#26       RST  #10       JP   NC,CRECD3       CP   #50          ; проверяем на ошибку 80 (выход за список каталога)       SCF       RET  NZ; ветка возвращения на уровень выше и удаления каталога из которого вышли       XOR  A            ; перебрали все файлы в каталоге, возвращаемся на уровень выше       LD   C,#26       RST  #10       RET  C       EXX       LD   BC,#000C       ADD  HL,BC       LD   E,(HL)       INC  HL       LD   D,(HL)       LD   C,#21       RST  #10       RET  C       CALL RECD10       LD   (HL),#00       LD   HL,CRLVL       DEC  (HL)       JR   Z,CRECD4     ; вернулись на 0-й уровень       JP   CRECD2       ; возвращаемся на уровень выше, переходим к следующему файлуCRECD3       OR   A       JP   Z,CRECD2     ; открыли файл с номером 0, это текущий каталог; здесь открыт файл и с ним можно проводить действия; HL'-адрес системного дескриптора открытого файла       EXX       PUSH HL       LD   BC,#000B       ADD  HL,BC       LD   A,(HL)       POP  HL       BIT  0,A         ; файл не удалён?       JP   Z,CRECD2     ; файл/каталог удалён, пропускаем       BIT  5,A         ; проверяем-открытый файл каталог?       JP   NZ,CRECD11DRECD33       CALL L634C       LD   DE,(BLKSM)       ADD  HL,DE       LD   (BLKSM),HLCRECD2       CALL RECD10       INC  (HL)       JR   DRECD1CRECD4       LD   IX,SREDA       XOR  A       LD   C,#37       RST  #10       LD   HL,#0000       LD   (CRLVL),HL       LD   DE,(L60DD)       LD   C,#27       RST  #10       RET  C       EXX       PUSH HL       JR   COPC02COPC01       PUSH HL       CALL L634C       ; подсчёт блоков при копировании       LD   (BLKSM),HL  ; единственного файлаCOPC02       EXX       CALL L635E       ; получаем в HL маску отметки текущего файла       DEC  HL          ; переходим на номер отметки	SET  0,(HL)	LD   A,#1       LD   (MRKFLS),A   ; число отмеченных файлов                        ; вывод написи "filename.ext" в       LD   HL,(MWTXDS)       LD   (HL),#22    ; кавычку открываем       INC  HL       POP  DE       EX   DE,HL       LD   C,#4F       RST  #10       EXX       EX   DE,HL       LD   (HL),#22    ; кавычку закрываем       INC  HL       LD   (HL),#20       INC  HL       LD   (HL),"в"       EXX       JR   L65F8                        ; вывод надписи в главное окно "xxx файл(а,ов) в"FLMRKD       LD   DE,(MRKFLS)       LD   HL,(MWTXDS)       PUSH HL       XOR  A       LD   A,3       LD   BC,#0A7C       RST  #10       POP  HL       LD   BC,#0004       ADD  HL,BC       EX   DE,HL       LD   HL,MLSTXT       LD   BC,MLSTLN       LDIR       LD   A,(L636E)    ; количество файлов в каталоге       LD   B,AFLMR01       LD   E,B       LD   C,#86       RST  #10       EXX       DEC  HL       LD   A,(HL)       EXX       OR   A       JR   Z,FLMR02       LD   C,#27       RST  #10       RET  C       EXX       CALL L634C       LD   DE,(BLKSM)       ADD  HL,DE       LD   (BLKSM),HLFLMR02       DJNZ FLMR01L65F8       LD   A,#1	LD   (L6161),A	LD   (L6094),A	LD   (L639E),A; Подготовка и вывод главного окна;       LD   IX,MWINV;       LD   A,#01;       LD   C,#61       ; выводим главное окно;       RST  #10;       LD   C,#66       ; текст главного окна;       RST  #10;       LD   IX,LTSWN;       LD   A,#FF;       LD   C,#61       ; красим область редактирования;       RST  #10;       LD   IX,L66B0;       LD   C,#61;       XOR  A;       RST  #10         ; рисуем большое фоновое окно;       LD   IX,L67E7;       LD   DE,L5DE5;       LD   HL,L67F3;       LD   A,(L60BE);       RRCA;       JR   NC,L661F    ; смотрим - это copy или move;       LD   HL,L67EF;       INC  DE;L661F  LD   A,(DE);       LD   (IX+#4),A;       XOR  A;       RST  #10         ; рисуем маленькое окно сверху;       LD   C,#67;       RST  #10         ; выводим соответствующую надпись copy/move; Уменьшение дискового кэша       CALL L6555       ; уменьшаем кэш до #0C блоков	LD   C,#10       RST  #10         ; получаем в HL адрес вектора конфигурации ядра       EXX	PUSH HL	POP  IX	LD   L,(IX+#5)       LD   H,(IX+#6)   ; HL - адрес начала электронного диска       LD   DE,(L64FD)  ; адрес начала буфера для копирования	OR   A       SBC  HL,DE       ; вычисляем количество свободной памяти (буфер для копирования)L663F	LD   A,#23	RET  C       LD   A,H         ; A-количество блоков	LD   (L64BC),A	AND  A       SCF	JR   Z,L663F       CALL L6825       ; Проверка расширенной памяти       JR   Z,L6654     ; NZ - нет расширенной памяти	LD   A,#1	LD   (L5DC4),AL6654;       LD   IX,L66CC       CALL L6770        ; процедура подготовки текста меню настроек;       LD   HL,L66D9;       LD   HL,MNUTXT;       LD   C,#67;       RST  #10L6665  CALL L5FA1        ; подпрограмма запроса пути куда копировать	RET  C       JR   Z,L6679      ; переход, если выход по Enter       CP   #10       JP   Z,L6045      ; нажат SS/A - выходим;       LD   IX,L66CC;       LD   IX,MNUWIN       LD   IX,MNUWIN       LD   A,#01       LD   C,#61       RST  #10       LD   C,#91       RST  #10          ; нажат SS/SP - работаем с меню       LD   A,(IX+#04)       PUSH AF       XOR  A       LD   (IX+#04),A       INC  A       LD   C,#61       RST  #10       POP  AF       LD   (IX+#04),A       JR   L6665L6679  CALL L6899        ; проверяем копирование на тот же диск	LD   A,(L5DC3)       AND  #8       CALL NZ,L653D     ; диски разные - открываем устройство и каталог назначения	RET  C	JR   NZ,L6665;       LD   A,(L66B4);       LD   (L66D0),A;       LD   A,#1;       LD   C,#61;       LD   IX,L66CC;       RST  #10          ; стираем окно с меню;       LD   DE,0         ; число отмеченных файлов;L6697  EQU  $-#2;       XOR  A;       LD   A,#3;       LD   HL,L5EBD;       LD   BC,LA7C      ; преобразуем количество отмеченных файлов в ascii;       RST  #10;       LD   IX,L5EB5;       CALL L5FF5        ; вывод окошка справа с количеством файлов;       CALL L5FF1        ; вывод окна с надписью SOURCE; здесь желательно сделать очистку главного окна; и подсчёт общего количества копируемых блоков       LD   DE,MVMNBT       LD   H,D       LD   L,E       DEC  HL       LD   BC,#0008       LDIR       LD   HL,FRMTXT       LD   DE,MVTXTW       LD   BC,FRTXLN       LDIR       LD   H,D       LD   L,E       INC  DE       LD   BC,30       LD   (HL),#20       LDIR       LD   HL,TOTXT       LD   DE,MVTX2W       LD   BC,TOTXLN       LDIR       LD   H,D       LD   L,E       INC  DE       LD   BC,31       LD   (HL),#20       LDIR       CALL LTSWCL       JP   L6015MRKFLS DEFW #0000        ; число отмеченных файловL66B0       DEFB #00       DEFB #08       DEFB #10       DEFB #20L66B4       DEFB #00       DEFB #FFL66B6       DEFW L6761       DEFW L6757       DEFW L6753       DEFW L673B       DEFW L6765L66C0  DEFB #04           ; цвет курсора при отра,отке Enter       DEFB #00           ; управляющий регистр менюL66C2  DEFB #39           ; цвет курсора       DEFB #01           ; позиция курсора       DEFW L6770         ; адрес инициализации символьного массива       DEFW #0000         ; адрес программы пользователя       DEFW #0000         ; адрес списка горячих клавиш       DEFW L66B6         ; адрес списка функций отработки по клавише Enter                          ; вектор окна с менюL66CC       DEFB #09       DEFB #09       DEFB #07       DEFB #0EL66D0  DEFB #00       DEFB #FF       DEFB #0D       DEFB #11L66D4  DEFB #01       DEFB #01       DEFB #01       DEFB #01       DEFB #01L66D9  DEFM "CHANGE DISK    "L66E8  DEFB #00	DEFB	#0D       DEFM "OVERWRITE      "L66F9  DEFB #00L66FA  DEFB #0D       DEFM "ASK OVERWRITE  "L6706  EQU  $-#4L670A  DEFB #00       DEFB #0D       DEFM "BUFFER    +16 kB"L6716  EQU  $-#6L6718  EQU  $-#4       DEFB #0D       DEFM "CHANGE PATH"L6725  EQU  $-#3       DEFB #03L6729  DEFM "   OFF+16 kB+80 kB"L672A  EQU  L6729+#1L672F  EQU  L6729+#6L6734  EQU  L6729+#0BL6735  EQU  L6729+#0CL6736  EQU  L6729+#0DMNUPRC       DEFW #0000       DEFW L6761       DEFW L6757       DEFW L6753       DEFW L673B       DEFW L6765       DEFW #0000MNUVEC DEFB #04           ; цвет курсора при отра,отке Enter       DEFB #00           ; управляющий регистр меню       DEFB %00000100     ; цвет курсора       DEFB #02           ; позиция курсора       DEFW L6770         ; адрес инициализации символьного массива       DEFW #0000         ; адрес программы пользователя       DEFW #0000         ; адрес списка горячих клавиш       DEFW MNUPRC        ; адрес списка функций отработки по клавише EnterMNUWIN       DEFB 7       DEFB 11       DEFB 9       DEFB 18       DEFB %00100000       DEFB %00000001       DEFB 11       DEFB 21       DEFB #00       DEFB #01       DEFB #01       DEFB #01       DEFB #01       DEFB #01       DEFB #00MNUTXT       DEFM "╔══════ Опции ══════╗"       DEFM "║ Cмена диска   [ ] ║"       DEFM "║ Перезапись    [ ] ║"       DEFM "║ Запрос прз.   [ ] ║"       DEFM "║ Буфер       [   ] ║"       DEFM "║ [Возврат]         ║"       DEFM "╚═══════════════════╝"       DEFB #03BUFNOR DEFM "Норм"BUF16K DEFM "+16k"BUF80K DEFM "+80k"CHDSAS EQU  MNUTXT + 38OVRWRA EQU  MNUTXT + 59OVWRAA EQU  MNUTXT + 80BUFMAA EQU  MNUTXT + 99MOVTTL DEFM "══ Перенос ══"MOVTLN EQU  $ - MOVTTLMOVTXT EQU  MOVTTL + 3MVTXLN EQU  8MLSTXT DEFM "файл(а,ов) в"MLSTLN EQU  $ - MLSTXTMWTXDS DEFW MWTXT + 51FRMTXT DEFM "из:"FRTXLN EQU  $ - FRMTXTTOTXT  DEFM "в:"TOTXLN EQU  $ - TOTXTLTSWN       DEFB 3       DEFB 9       DEFB 2       DEFB 26       DEFB %00101000       DEFB #FF       DEFB 5       DEFB 33; флаг копирования директорииCPDFLG DEFB #00L673B  LD   HL,L5DC4	LD   A,(HL)	CP   #5	LD   A,#B	JR   Z,L674B	LD   A,#5	JR   C,L674B	LD   A,#1L674B	LD   (HL),A	CALL L6825L674F	JR   Z,L675E	JR   L673BL6753  LD   A,#2	JR   L6759L6757  LD   A,#1L6759	LD   HL,L5DC3	XOR  (HL)	LD   (HL),AL675E	XOR  A	INC  A       RETL6761	LD   A,#8	JR   L6759L6765       OR   #FF       RET; 0-й бит в B=1 - A="Y", B=0 - A="N"L6768  RRC  B       LD   A,#20	RET  NC       LD   A,#FB       RET; подпрограмма меню инициализации символьного массиваL6770  LD   A,(L5DC3)       LD   B,A       ; в B помещаем байт конфигурации	CALL L6768;       LD   (L66F9),A       LD   (OVRWRA),A	CALL L6768;       LD   (L670A),A       LD   (OVWRAA),A	RRC  B	CALL L6768       XOR  #DB        ; меняем галку на пробел, или обратно;       XOR  #17       ; меняем Y на N, или N на Y;       LD   (L66E8),A ; помещаем результат в CHANGE DISK       LD   (CHDSAS),A       LD   A,(L5DC4);       LD   DE,L6716       LD   DE,BUFMAA	CP   #5;       LD   HL,L6729       LD   HL,BUFNOR	JR   C,L679F;       LD   HL,L672F       LD   HL,BUF16K	JR   Z,L679F;       LD   HL,L6735       LD   HL,BUF80KL679F;       LD   BC,L6       LD   BC,#0003       PUSH HL       LDIR           ; копируем строку +16 kb/+80 kb       LD   HL,BUFNOR       XOR  A       XOR  H       XOR  L       POP  HL       XOR  H       XOR  L       JR   NZ,BFINMW       LD   HL,MVBIND - 1 ; если в HL адрес BUFNOR, то заменяем его на MVBIND-1, там будет "═"                          ; копируем его 4 разаBFINMW       LD   DE,MVBIND       LD   BC,#0004       LDIR           ; индикация буфера на главном окне	XOR  A       RETL67A6	LD   C,#41	RST  #10	RET  C       LD   C,#43        ; получаем в A ключ командной строки (/c,/m, т.д.)	RST  #10	RET  C	LD   C,#41       JP   NZ,#0010     ; ключа нет после восстановления возврат	OR   A       JR   Z,L67A6      ; обнаружен путь\файл       RES  5,A          ; анализируем ключи       CP   #41          ; /a/A	JR   Z,L67D3       CP   #42          ; /b/B	JR   Z,L67D8	LD   HL,L67D0       LD   BC,#0301L67C6	CP   (HL)	JR   Z,L67DF	SLA  C	INC  HL	DJNZ L67C6	JR   L67A6L67D0       DEFM "MCS"        ; возможные ключиL67D3	LD   (L5FAC),A	JR   L67A6L67D8	LD   A,#1	LD   (L5DC4),A	JR   L67A6L67DF	LD   HL,L60BE	LD   A,C	OR   (HL)       LD   (HL),A       ; с ключом /c получаем #00 OR #02	JR   L67A6L67E7	DEFB	#0D	DEFB	#06	DEFB	#03	DEFB	#06	DEFB	#00	DEFB	#FF	DEFB	#13	DEFB	#04L67EF       DEFM "MOVE"L67F3       DEFM "COPY"L67F7       LD   DE,L5DD8    ; цвета в маркере UnCo       LD   HL,L680B    ; таблица адресов, куда надо разместить цвета       LD   B,#D        ; адресов 13L67FF	LD   A,(DE)	INC  DE	PUSH DE	LD   E,(HL)	INC  HL	LD   D,(HL)	INC  HL	LD   (DE),A	POP  DE	DJNZ L67FF       RETL680B       DEFW L5EC4       DEFW L5ED2       DEFW L66B4       DEFW L66D0       DEFW L66C2       DEFW L66C0       DEFW L5E9E       DEFW L5EB1       DEFW L5EA6       DEFW L5EB9       DEFW L5F4F       DEFW L5EE5       DEFW L5EF4; подпрограмма проверки работы с расширенной памятьюL6825       LD   A,(L5DC4)       DEC  A	RET  Z	CP   #4	LD   DE,L5E53	LD   BC,(L5DC7)	LD   A,(L5DCB)	LD   HL,(L5DCD)	LD   H,#0	JR   Z,L684C	LD   DE,L5DE9	LD   BC,(L5DC9)	LD   A,(L5DCC)	LD   HL,(L5DCE)	LD   H,#C0L684C	LD   (L64EE),DE	LD   (L5E7D),BC	LD   (L5E94),A	LD   D,A	LD   E,(HL)       DI	LD   A,(HL)	DEC  (HL)	DEC  A	XOR  (HL)	LD   (HL),E	JR   NZ,L6868	LD   A,H	OR   A	JR   NZ,L6868	INC  A       EI       RETL6868	OUT  (C),L	LD   A,(HL)	DEC  (HL)	DEC  A	XOR  (HL)	OUT  (C),D       EI	RET  NZ	LD   A,(HL)	CP   E	LD   (HL),E	RET  NZ       DI	OUT  (C),L	INC  (HL)	OUT  (C),D       EI	XOR  A       RETL687F	LD   A,(L5DC4)	DEC  A	RET  Z	LD   HL,(L64EE)	LD   E,(HL)	INC  HL	LD   D,(HL)	EX   DE,HL	LD   B,A	LD   A,(L64BC)L688F	CP   (HL)	JR   NC,L6893	LD   (HL),AL6893	INC  HL	INC  HL	INC  HL	DJNZ L688F       RETL6899  LD   HL,L5F53     ; буфер путиL689C	LD   A,(HL)       CP   #3A          ; проверяем первй символ на ":"       JR   Z,L68A7      ; нашли в пути : после имени диска	CP   #D	INC  HL	JR   NZ,L689C       RETL68A7  DEC  HL	LD   A,(HL)	LD   C,#4A       RST  #10          ; преобразуем имя диска в номер диска	RET  NZ       LD   (L62FD),A	LD   HL,L62FC       CP   (HL)         ; проверяем копирование на один и тот же диск	RET  Z	LD   HL,L5DC3       SET  3,(HL)       ; диск не один и тот же - устанавливаем бит запроса смены диска       RETLC066	EQU	#C066LD25E  EQU  #D25E